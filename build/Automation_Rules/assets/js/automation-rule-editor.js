(()=>{"use strict";var e,t={5338(e,t,r){var n=r(5795);t.H=n.createRoot,n.hydrateRoot},5795(e){e.exports=window.ReactDOM},9844(e,t,r){const n=window.wp.domReady;var s=r.n(n);const a=window.React;var i=r.n(a);const o=window.wp.components,l=window.wp.i18n;function c(e){var t,r,n="";if("string"==typeof e||"number"==typeof e)n+=e;else if("object"==typeof e)if(Array.isArray(e)){var s=e.length;for(t=0;t<s;t++)e[t]&&(r=c(e[t]))&&(n&&(n+=" "),n+=r)}else for(r in e)e[r]&&(n&&(n+=" "),n+=r);return n}const u=function(){for(var e,t,r=0,n="",s=arguments.length;r<s;r++)(e=arguments[r])&&(t=c(e))&&(n&&(n+=" "),n+=t);return n},d=window.ReactJSXRuntime;function p({title:e,isSecodary:t=!1,className:r="",children:n}){const[s,i]=(0,a.useState)(!0);return(0,d.jsxs)(o.Card,{variant:t?"secondary":"primary",className:u("noptin-component__section",r),children:[(0,d.jsxs)(o.CardHeader,{children:[(0,d.jsx)(o.__experimentalHeading,{level:3,size:18,children:e}),(0,d.jsx)(o.Button,{variant:"tertiary",onClick:()=>i(!s),children:(0,d.jsx)(o.Icon,{icon:s?"arrow-up-alt2":"arrow-down-alt2"})})]}),s&&n]})}function m({label:e,value:t}){const r=e.toLowerCase().replace(/[^a-z0-9]/g,"-");return(0,d.jsxs)(o.__experimentalGrid,{columns:2,className:`noptin-list-item noptin-list-item__${r}`,children:[(0,d.jsx)("div",{className:"noptin-list-item__key",children:e}),(0,d.jsx)("div",{className:"noptin-list-item__value",children:t})]})}function _({items:e}){return(0,d.jsx)(o.__experimentalVStack,{className:"noptin-component__list",children:e.map(e=>(0,d.jsx)(m,{label:e.label,value:e.value},e.label))})}const x=window.wp.apiFetch;var h=r.n(x);const g=(0,a.createContext)({automationRule:{id:0,action_id:"",trigger_id:"",action_settings:{},status:!0,trigger_settings:{},smartTags:{},settings:{},times_run:0,created_at:"",updated_at:"",delay:0,metadata:[]},save:()=>{},setAttributes:()=>{},isSaving:!1,error:"",success:"",resetMessages:()=>{}}),b=()=>(0,a.useContext)(g),j=({automationRule:e,children:t})=>{const[r,n]=(0,a.useState)(e),[s,i]=(0,a.useState)(!1),[o,c]=(0,a.useState)(""),[u,p]=(0,a.useState)(""),m=(0,a.useRef)(!1);(0,a.useEffect)(()=>{const e=e=>{if(m.current)return e.returnValue=(0,l.__)("You have unsaved changes. If you proceed, they will be lost."),e.returnValue};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[m.current]);const _=r.id>0?`/noptin/v1/automation_rules/${r.id}`:"/noptin/v1/automation_rules/",x=(0,a.useCallback)(()=>{i(!0),c(""),p(""),m.current=!1;const e={...r};delete e.smartTags,delete e.settings,h()({path:_,method:"POST",data:e}).then(e=>(p((0,l.__)("Automation rule saved.","newsletter-optin-box")),n({...r,...e||{}}),e)).then(e=>{e.id>0&&window.history.replaceState({},"",`?page=noptin-automation-rules&noptin_edit_automation_rule=${e.id}`)}).catch(e=>{e.message?c(e.message):c((0,l.__)("An error occurred while saving.","newsletter-optin-box"))}).finally(()=>{i(!1)})},[r,_,i,c,p]),b=(0,a.useCallback)(()=>{c(""),p("")},[c,p]),j=(0,a.useCallback)(e=>{m.current=!0,n({...r,...e})},[r,n]),y=(0,a.useMemo)(()=>({automationRule:r,save:x,setAttributes:j,isSaving:s,error:o,success:u,resetMessages:b}),[r,x,j,s,o,u,b]),w={opacity:s?.5:1,pointerEvents:s?"none":"auto"};return(0,d.jsx)(g.Provider,{value:y,children:(0,d.jsx)("div",{style:w,children:t})})};function y(e){if(!e)return"-";const t=new Date;return"string"==typeof e?t.setTime(Date.parse(e)):t.setTime(Date.parse(e.date)),t.toLocaleString()}function w(){const{automationRule:e,isSaving:t,setAttributes:r,save:n}=b(),s=[{label:(0,l.__)("ID","newsletter-optin-box"),value:e.id>0?e.id:(0,l.__)("New","newsletter-optin-box")},{label:(0,l.__)("Status","newsletter-optin-box"),value:(0,d.jsx)(o.ToggleControl,{label:e.status?(0,l.__)("Active","newsletter-optin-box"):(0,l.__)("Inactive","newsletter-optin-box"),checked:!!e.status,onChange:e=>{r({status:e})},__nextHasNoMarginBottom:!0})}];return e.id>0&&(s.push({label:(0,l.__)("Times Run","newsletter-optin-box"),value:e.times_run},{label:(0,l.__)("Created at","newsletter-optin-box"),value:y(e.created_at)},{label:(0,l.__)("Updated at","newsletter-optin-box"),value:y(e.updated_at)}),Array.isArray(e.metadata)||Object.keys(e.metadata).forEach(t=>{"string"!=typeof e.metadata[t]&&"number"!=typeof e.metadata[t]||s.push({label:t,value:e.metadata[t]})})),(0,d.jsx)(p,{title:(0,l.__)("Save","newsletter-optin-box"),children:(0,d.jsxs)(o.CardBody,{as:o.__experimentalVStack,children:[(0,d.jsx)(_,{items:s}),(0,d.jsx)("div",{children:(0,d.jsxs)(o.Button,{variant:"primary",onClick:n,disabled:t,isPressed:t,children:[!t&&(0,l.__)("Save Automation","newsletter-optin-box"),t&&(0,l.__)("Saving...","newsletter-optin-box"),t&&(0,d.jsx)(o.Spinner,{})]})})]})})}const v=window.wp.primitives;var f=(0,d.jsx)(v.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,d.jsx)(v.Path,{d:"M17 10h-1.2V7c0-2.1-1.7-3.8-3.8-3.8-2.1 0-3.8 1.7-3.8 3.8v3H7c-.6 0-1 .4-1 1v8c0 .6.4 1 1 1h10c.6 0 1-.4 1-1v-8c0-.6-.4-1-1-1zm-2.8 0H9.8V7c0-1.2 1-2.2 2.2-2.2s2.2 1 2.2 2.2v3z"})});const S=window.wp.url,k=window.noptinEmailEditorSettings||{},C=window.noptinEmailSettingsMisc||{},A=C.license?.key&&/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}|HL-(?:[A-Z0-9]{5}-){4}[A-Z0-9]{5}|[0-9a-f]{24,32})$/i.test(C.license.key)?C.license.key:"",T=k.types||{},O=(Object.keys(T).map(e=>({value:e,label:T[e].label})),Object.keys(k.templates||{}).map(e=>({value:e,label:k.templates[e]})),{utm_source:"Noptin Plugin Dashboard"});C.data?.plural_label&&(O.utm_medium=C.data?.plural_label);const N=C.license||{},P=({heading:e,helpText:t,needsAddonsPack:r,utm:n={}})=>{if(R(r))return[!0,null];const s=r&&N.install_desc||(0,l.__)("Activate your license key to unlock","newsletter-optin-box"),a=r&&N.install_text||(0,l.__)("View Pricing","newsletter-optin-box");let i=r&&N.install_url||N.upgrade_url||"https://noptin.com/pricing/";return i=(0,S.addQueryArgs)(i,{...O,...n}),[!1,(0,d.jsx)(o.Placeholder,{icon:f,label:e||(0,l.__)("Premium Feature","newsletter-optin-box"),className:"noptin-premium-feature",children:(0,d.jsxs)(o.__experimentalVStack,{spacing:4,children:[t&&(0,d.jsx)("div",{children:t}),(0,d.jsx)("div",{children:s}),(0,d.jsxs)(o.__experimentalHStack,{justify:"start",wrap:!0,children:[!A&&(0,d.jsx)(o.Button,{href:N.activate_url,variant:"secondary",target:"_blank",text:(0,l.__)("Activate license","newsletter-optin-box"),style:{margin:0}}),(0,d.jsx)(o.Button,{href:i,variant:"primary",target:"_blank",text:a,style:{margin:0}})]})]})})]},R=e=>(!e||N.is_usable)&&A,M=/_published|_unpublished|_deleted|_user_role|_anniversary$/,B=["noptin_subscriber_","delete_user","new_user","update_user","wp_login","after_password_reset","create_or_update_"],E=[["woocommerce","subscription"],["latest_","_digest"]],D=["WordPress Users"],V=["latest_posts_digest"],F=["periodic"],L=(e,t=void 0)=>{if(!e||V.includes(e))return!1;if(F.includes(e))return!0;if(t&&D.includes(t))return!0;if(E.some(t=>t.every(t=>e.includes(t))))return!0;const r=e.replace(/^automation_rule_/,"");return M.test(r)?"post_published"!==r:B.some(e=>r.startsWith(e))};function z(){const{automationRule:{delay:e,trigger_id:t,action_id:r},setAttributes:n}=b(),[s,a]=P({heading:(0,l.__)("Delay running this automation","newsletter-optin-box"),helpText:(0,l.__)("Premium plans allow you to delay (schedule) this automation rule for a given number of minutes, hours, or days.","newsletter-optin-box"),needsAddonsPack:!1,utm:{utm_medium:"Automation Rules",utm_campaign:"Delay Automation Rule",utm_term:t,utm_content:r}});return(0,d.jsx)(p,{title:(0,l.__)("Delay","newsletter-optin-box"),children:(0,d.jsxs)(o.CardBody,{children:[!s&&a,s&&(0,d.jsx)(o.__experimentalNumberControl,{label:(0,l.__)("Delay","newsletter-optin-box"),help:(0,d.jsxs)(d.Fragment,{children:[(0,l.__)("The number of seconds to delay this automation rule.","newsletter-optin-box")," ",(0,d.jsx)(o.ExternalLink,{href:"https://noptin.com/guide/automation-rules/automation-rule-delays/",children:(0,l.__)("Learn more","newsletter-optin-box")})]}),value:e,onChange:e=>n({delay:e}),suffix:(0,d.jsx)(o.__experimentalInputControlSuffixWrapper,{children:(0,l.__)("Seconds","newsletter-optin-box")}),__next40pxDefaultSize:!0})]})})}const H=window.hizzlewp.components;class I extends i().Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){this.setState({error:e,errorInfo:t})}render(){return this.state.hasError?(0,d.jsx)("div",{children:(0,d.jsxs)("div",{style:{backgroundColor:"#FEE2E2",border:"1px solid #F87171",color:"#B91C1C",padding:"0.75rem 1rem",borderRadius:"0.25rem",position:"relative"},role:"alert",children:[(0,d.jsx)(o.__experimentalText,{as:"strong",weight:500,color:"#B91C1C",children:"Oops! Something went wrong."})," ",(0,d.jsx)(o.__experimentalText,{color:"#B91C1C",children:"This error is being logged. Try clearing your browser's cache and reloading the page."}),(0,d.jsxs)("details",{style:{marginTop:"0.5rem",fontSize:"0.875rem"},children:[(0,d.jsx)("summary",{children:"Click for error details"}),(0,d.jsxs)("pre",{style:{overflow:"auto",fontSize:"0.875rem",marginTop:"0.5rem"},children:[this.state.error&&this.state.error.toString(),(0,d.jsx)("br",{}),this.state.errorInfo?.componentStack]})]})]})}):this.props.children}}const G=I,U=(0,a.createContext)([]),Q=({children:e})=>{const{automationRule:{trigger_settings:t,smartTags:r}}=b(),n=(0,a.useMemo)(()=>(0,H.prepareAvailableSmartTags)(r,t||{}),[r,t]);return(0,d.jsx)(U.Provider,{value:n,children:e})};function $({sectionKey:e,label:t,prop:r,settings:n,conditions:s}){const[i,c]=(0,a.useState)(!1),u=(0,a.useContext)(U);if(!Object.keys(n).length)return null;const{automationRule:m,setAttributes:_}=b(),{normal:x,advanced:h}=(0,a.useMemo)(()=>{const e={...n},t={},r={};return Object.keys(e).forEach(n=>{"select"!==e[n].el||e[n].multiple||(e[n]={...e[n],el:"combobox"}),e[n].advanced?r[n]=e[n]:t[n]=e[n]}),{normal:t,advanced:r}},[n]);if(Array.isArray(s)&&!s.every(e=>{const t=e.key.split("."),r=e.operator?e.operator:"==";return(0,H.compare)(e.value,r,(0,H.getNestedValue)(m,t))}))return null;const g=Object.keys(h).length>0;return(0,d.jsx)(G,{children:(0,d.jsx)(p,{title:t,className:`noptin-automation-rule-editor__section noptin-automation-rule-editor__section-${e}`,children:(0,d.jsxs)(o.__experimentalVStack,{spacing:5,as:o.CardBody,children:[Object.keys(x).map(e=>(0,d.jsx)(H.Setting,{settingKey:e,prop:r,availableSmartTags:u,saved:m,setAttributes:_,setting:x[e]},e)),g&&(0,d.jsx)("div",{children:(0,d.jsx)(o.Button,{onClick:()=>c(!i),isPressed:i,variant:"tertiary",children:i?(0,l.__)("Hide advanced settings","newsletter-optin-box"):(0,l.__)("Show advanced settings","newsletter-optin-box")})}),g&&i&&(0,d.jsx)(o.__experimentalVStack,{spacing:5,children:Object.keys(h).map(e=>(0,d.jsx)(H.Setting,{settingKey:e,prop:r,availableSmartTags:u,saved:m,setAttributes:_,setting:h[e]},e))})]})})})}function W(){const{error:e,success:t,resetMessages:r,automationRule:{settings:n}}=b(),s=(0,d.jsxs)(d.Fragment,{children:[e&&(0,d.jsx)(o.Notice,{status:"error",onDismiss:r,children:e}),t&&(0,d.jsx)(o.Notice,{status:"success",onDismiss:r,children:t})]});if(!n)return s;const a=Object.keys(n);return a.length?(0,d.jsxs)(o.__experimentalVStack,{spacing:8,className:"noptin-automation-rule-editor__sections",children:[s,(0,d.jsx)(G,{children:a.map(e=>(0,d.jsx)($,{sectionKey:e,...n[e]},e))})]}):s}const K=window.noptinEmailSettingsMisc||{};function Z(e,t){const r={},n=(0,l.__)("Featured","newsletter-optin-box"),s=()=>{r[n]||(r[n]={})},a=(e,t)=>e?.is_recommended||e?.featured||t?.is_recommended||t?.featured;Array.isArray(e)||Object.entries(e).forEach(([e,i])=>{if("email"!==e){if(!i.category){if(!K.isTest)return;i.category="Deprecated"}r[i.category]||(r[i.category]={}),r[i.category][e]={...i,selectText:"triggers"===t?(0,l.__)("Use trigger","newsletter-optin-box"):(0,l.__)("Set-up","newsletter-optin-box"),forcePremium:L(e,i.category)},i.image&&i.image.icon&&["category","editor-table"].includes(i.image.icon)&&(r[i.category][e].forcePremium=!0),a(i)&&(s(),r[n][e]=r[i.category][e]),i.alt_category&&(r[i.alt_category]||(r[i.alt_category]={}),r[i.alt_category][e]=r[i.category][e])}}),Array.isArray(K.integrations)&&K.integrations.forEach(i=>{i.plan&&"free"!==i.plan&&i[t]&&!Array.isArray(i[t])&&Object.entries(i[t]).forEach(([t,o])=>{o.forEach(({id:o,label:l,description:c,premium:u=!1,is_recommended:d=!1,featured:p=!1})=>{if("premium"===i.plan||u){if(e[o]){const t=e[o].category;return void(t&&r[t][o]&&(r[t][o].forcePremium=!0,a(e[o],{is_recommended:d,featured:p})&&(s(),r[n][o]=r[t][o])))}r[t]||(r[t]={}),r[t][o]={name:o,label:l,description:c,category:t,image:i.icon_url,forcePremium:!0,is_installed:!1,installation:i.installation},a(null,{is_recommended:d,featured:p})&&(s(),r[n][o]=r[t][o])}})})});const i={},o=(0,l.__)("General","newsletter-optin-box");return r.hasOwnProperty(n)&&(i[n]=r[n]),r.hasOwnProperty(o)&&(i[o]=r[o]),Object.keys(r).sort().forEach(e=>{e!==n&&e!==o&&(i[e]=r[e])}),i}K.license?.key&&/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}|HL-(?:[A-Z0-9]{5}-){4}[A-Z0-9]{5}|[0-9a-f]{24,32})$/i.test(K.license.key)&&K.license.key;const q={"noptin-trigger":{title:(0,l.__)("Select a trigger for your automation rule","newsletter-optin-box"),show:!0,arg:"noptin-trigger",cardGroups:Z(K.data?.triggers||{},"triggers")},"noptin-action":{title:(0,l.__)("Select an action for your automation rule","newsletter-optin-box"),show:!0,arg:"noptin-action",cardGroups:Z(K.data?.actions||{},"actions")}},J=(0,a.createContext)(void 0),X=({children:e})=>{const[t,r]=(0,a.useState)(K.data?.add_new||(0,S.addQueryArgs)(window.location.href,{noptin_edit_automation_rule:"0"})),n=(0,a.useMemo)(()=>{let e="";const n={};for(const[r,s]of Object.entries(q)){const a=s.arg?(0,S.getQueryArg)(t,s.arg):"";if(!a){e=r;break}n[r]=a}return{currentTitle:q[e]?.title||"",currentStep:e,isLastStep:e===Object.keys(q).pop(),isFirstStep:e===Object.keys(q)[0],hasSteps:Object.keys(q).length>0,stepValues:n,steps:q,campaign:"automation-rules",removeQueryArgs:(...e)=>{r((0,S.removeQueryArgs)(t,...e))},addQueryArg:(e,n)=>{r((0,S.addQueryArgs)(t,{[e]:n}))},withQueryArg:(e,r)=>(0,S.addQueryArgs)(t,{[e]:r}),url:t}},[t,r]);return(0,d.jsx)(J.Provider,{value:n,children:e})},Y=({title:e,isOpen:t,closeModal:r,back:n,...s})=>{const a=(0,d.jsx)(d.Fragment,{children:n&&(0,d.jsx)(o.Button,{icon:"arrow-left-alt",onClick:n,label:(0,l.__)("Back","newsletter-optin-box"),showTooltip:!0})});return(0,d.jsx)(d.Fragment,{children:t&&(0,d.jsx)(o.Modal,{title:e,onRequestClose:r,headerActions:a,isFullScreen:!0,children:(0,d.jsx)(pe,{...s})})})},ee=window.wp.compose,te={borderRadius:"5px"},re=({categories:e,selectedCategory:t,onClickCategory:r})=>{const n="noptin-campaign-explorer__sidebar",s=(0,ee.useViewportMatch)("medium","<");return(0,d.jsxs)(o.__experimentalSurface,{className:n,variant:s?"primary":"secondary",style:te,children:[!s&&(0,d.jsx)(o.__experimentalElevation,{value:2}),(0,d.jsx)(o.NavigableMenu,{className:`${n}__categories-list`,orientation:s?"horizontal":"vertical",onNavigate:t=>r(e[t]),children:e.map(e=>(0,d.jsx)(o.Button,{label:e,text:e,className:`${n}__categories-list__item`,isPressed:t===e,onClick:()=>r(e)},e))})]})},ne=window.wp.element,se=({image:e,title:t})=>{if("string"==typeof e&&e.startsWith("http"))return(0,d.jsx)("img",{src:e,width:24,alt:t,style:{maxWidth:24,height:"auto"}});if(e&&"string"==typeof e)return(0,d.jsx)(o.Icon,{size:24,icon:e,style:{color:"#424242"}});if(e&&"object"==typeof e){const t=e.fill||"#008000",r=e.path||"",n=e.viewBox||"0 0 24 24";return e.path?(0,d.jsx)(o.SVG,{viewBox:n,xmlns:"http://www.w3.org/2000/svg",style:{maxWidth:24},children:(0,d.jsx)(o.Path,{fill:t,d:r})}):(0,d.jsx)(o.Icon,{size:24,style:{color:t},icon:e.icon})}return(0,d.jsx)(o.Icon,{size:24,icon:"email",style:{color:"#424242"}})},ae=({learnMoreUrl:e,previewURL:t,action:r})=>{const[n,s]=(0,a.useState)(!1),[i,c]=(0,a.useState)(!0),u=()=>s(!1);return e?(0,d.jsxs)(o.Button,{variant:"secondary",href:e,target:"_blank",children:[(0,d.jsx)("span",{className:"noptin-selectable-card-action__label",children:(0,l.__)("Learn More")})," ",(0,d.jsx)(o.Icon,{size:16,icon:"arrow-right-alt"})]}):t?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(o.Button,{variant:"secondary",onClick:()=>s(!0),children:[(0,d.jsx)("span",{className:"noptin-selectable-card-action__label",children:(0,l.__)("Preview")})," ",(0,d.jsx)(o.Icon,{size:16,icon:"visibility"})]}),n&&(0,d.jsxs)(o.Modal,{title:(0,l.__)("Preview"),onRequestClose:u,className:"noptin-preview-modal",headerActions:(0,d.jsxs)(o.__experimentalHStack,{justify:"flex-end",wrap:!0,children:[r,(0,d.jsx)(o.Button,{variant:r?"secondary":"primary",onClick:u,children:(0,l.__)("Back to templates")})]}),isDismissible:!1,isFullScreen:!0,children:[i&&(0,d.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:(0,d.jsx)(o.Spinner,{})}),(0,d.jsx)("iframe",{src:t,style:{width:"100%",height:"100%",border:"none",display:i?"none":"block"},onLoad:()=>c(!1)})]})]}):null},ie=({name:e,label:t,description:r,image:n,useValue:s,onSelect:i,hrefCallback:c,href:p,isTemplate:m,..._})=>{const x=void 0===s?e:s,h=(e=>{if(e.forcePremium?!1!==e.is_installed&&e?.licenseDetails?.key:!1!==e.is_installed){const t=e.primary||(0,d.jsxs)(o.Button,{variant:"primary",onClick:e.onClick,href:e.href,children:[(0,d.jsx)("span",{className:"noptin-selectable-card__label",children:e.selectText||(0,l.__)("Select")})," ",(0,d.jsx)(o.Icon,{size:16,icon:"arrow-right-alt"})]});return{upgradeText:null,button:t,secondaryButton:(0,d.jsx)(ae,{learnMoreUrl:e.learnMoreUrl,previewURL:e.previewURL,action:t})}}const t=(t,r)=>!1===e.is_installed&&e.installation?.[t]?e.installation?.[t]:e.licenseDetails[t]||r,r=t("install_desc",(0,l.__)("Activate your license key to unlock","newsletter-optin-box")),n=t("install_text",(0,l.__)("View Pricing","newsletter-optin-box")),s=t("install_url",(0,S.addQueryArgs)("https://noptin.com/pricing/",{utm_source:"Noptin Plugin Dashboard",utm_medium:e.medium||void 0,utm_campaign:e.campaign||"noptin",utm_term:e.name||void 0})),a=(0,d.jsxs)(o.Button,{variant:"primary",href:s,target:"_blank",children:[(0,d.jsx)("span",{className:"noptin-selectable-card-action__label",children:n})," ",(0,d.jsx)(o.Icon,{size:16,icon:"lock"})]}),i=!e.licenseDetails?.key&&(0,d.jsxs)(o.Button,{variant:"secondary",href:e.licenseDetails?.activate_url,children:[(0,d.jsx)("span",{className:"noptin-selectable-card-action__label",children:(0,l.__)("Activate")})," ",(0,d.jsx)(o.Icon,{size:16,icon:"unlock"})]});return{upgradeText:r,button:a,secondaryButton:e.licenseDetails?.key||e.previewURL?(0,d.jsx)(ae,{learnMoreUrl:e.learnMoreUrl,previewURL:e.previewURL,action:[a,i]}):i}})({onClick:(0,a.useCallback)(()=>i?i(x):null,[x,i]),name:e.replace("automation_rule_",""),href:c?c(x):p,..._}),g=u("noptin-selectable-card",`noptin-selectable-card__${x}`,m&&"noptin-selectable-card--template");return(0,d.jsxs)(o.Card,{className:g,size:"small",children:[(0,d.jsxs)(o.CardHeader,{children:[(0,d.jsx)(o.__experimentalHeading,{level:4,numberOfLines:1,children:t}),(0,d.jsx)(se,{image:n,title:t})]}),m&&n?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"noptin-template-preview__image-wrapper",children:(0,d.jsx)("img",{src:n,alt:t,className:"noptin-template-preview__image"})}),(0,d.jsx)(o.CardBody,{children:h.upgradeText&&(0,d.jsx)(o.__experimentalText,{as:"em",isDestructive:!0,children:h.upgradeText})})]}):(0,d.jsx)(o.CardBody,{style:{flexGrow:1},children:(0,d.jsxs)(o.__experimentalVStack,{spacing:4,children:[r&&(0,d.jsx)(o.__experimentalText,{as:"p",variant:"muted",children:r}),m&&!n&&(0,d.jsx)(o.__experimentalText,{as:"em",variant:"muted",children:(0,l.__)("No preview available","newsletter-optin-box")}),h.upgradeText&&(0,d.jsx)(o.__experimentalText,{as:"em",isDestructive:!0,children:h.upgradeText})]})}),(0,d.jsxs)(o.CardFooter,{isBorderless:!0,justify:h.secondaryButton?"space-between":"flex-end",children:[h.secondaryButton,h.button]}),(0,d.jsx)(o.__experimentalElevation,{value:1,hover:3})]})},oe=({value:e,onChange:t,placeholder:r})=>(0,d.jsx)(o.SearchControl,{value:e,onChange:t,placeholder:r||"Search ...",className:"noptin-campaign-explorer__search",__nextHasNoMarginBottom:!0}),le=["xhuge","huge","wide","xlarge","medium"],ce=({showTitle:e,showSidebar:t,selectedCategory:r,cards:n,searchPlaceholder:s,searchValue:a,onSearchChange:i,...c})=>{const u=le.map(e=>(0,ee.useViewportMatch)(e,">=")).filter(e=>e).length||1,p="noptin-campaign-explorer";let m=Object.entries(n);m.some(([,e])=>e.isTemplate)||m.sort((e,t)=>{if((0,l.__)("Search Results","newsletter-optin-box")===r)return e[1].label.localeCompare(t[1].label);const n=["latest_posts_digest","automation_rule_post_published","automation_rule_noptin_subscriber_status_set_to_subscribed","periodic","manual_recipients"],s=n.includes(e[0])||e[1].orderFirst,a=n.includes(t[0])||t[1].orderFirst;if(s&&!a)return-1;if(!s&&a)return 1;const i=e[1].featured||e[1].is_recommended,o=t[1].featured||t[1].is_recommended;return i&&!o?-1:!i&&o?1:e[1].label.localeCompare(t[1].label)});const _=m.reduce((e,[t,r])=>(r.forcePremium&&!c.licenseDetails?.key?e[1].push([t,r]):e[0].push([t,r]),e),[[],[]]);return(0,d.jsxs)(o.FlexBlock,{className:`${p}__list`,children:[i&&(0,d.jsx)(oe,{value:a||"",placeholder:s,onChange:i}),e&&(0,d.jsx)(o.__experimentalHeading,{level:2,lineHeight:"48px",className:`${p}__category-name`,children:r}),(0,d.jsxs)(o.__experimentalGrid,{role:"listbox",className:`${p}-list`,columns:t&&u>1?u-1:u,rowGap:32,columnGap:32,children:[_[0].map(([e,t])=>(0,d.jsx)(ie,{name:e,...c,...t},e)),_[1].map(([e,t])=>(0,d.jsx)(ie,{name:e,...c,...t},e))]})]})},ue=({children:e,showSidebar:t,...r})=>{const n=(0,ee.useViewportMatch)("medium","<");return t?n?(0,d.jsx)(o.__experimentalVStack,{spacing:4,...r,children:e}):(0,d.jsx)(o.__experimentalHStack,{spacing:4,...r,justify:"stretch",alignment:"start",style:{maxHeight:"100%"},children:e}):(0,d.jsx)("div",{...r,children:e})},de=(0,l.__)("Search Results","newsletter-optin-box"),pe=({cardGroups:e,showSearch:t=!1,...r})=>{const[n,s]=(0,a.useState)(""),i=(0,a.useMemo)(()=>n.trim()?[...new Set([de,...Object.keys(e)])]:Object.keys(e),[e,n]),o=i.length,[l,c]=(0,a.useState)(i[0]||""),p=(0,a.useCallback)(e=>{de!==e&&s(""),c(e)},[c,s]),m=(0,a.useRef)(l);(0,a.useEffect)(()=>{o>0&&!i.includes(l)&&c(i.includes(m.current)?m.current:i[0])},[i,l,o]),(0,a.useEffect)(()=>{n.trim()?l!==de&&(m.current=l,c(de)):l===de&&m.current&&c(i.includes(m.current)?m.current:i[0])},[n,i,l]);const _=o>1,x=(0,a.useMemo)(()=>{if(n.trim()&&l===de){const t=n.toLowerCase(),r={};return Object.values(e).forEach(e=>{Object.entries(e).forEach(([e,n])=>{"Deprecated"!==n.category&&(n.label?.toLowerCase().includes(t)||n.name?.toLowerCase().includes(t))&&(r[e]=n)})}),r}return e[l]||{}},[e,l,n]),h=u("noptin-campaign-explorer",{"noptin-campaign-explorer--show-sidebar":_});return(0,d.jsxs)(ue,{className:h,showSidebar:_,children:[_&&(0,d.jsx)(re,{selectedCategory:l,categories:i,onClickCategory:p}),(0,d.jsx)(ce,{showTitle:_,showSidebar:_,selectedCategory:l,cards:x,searchValue:n,onSearchChange:t?s:void 0,...r})]})},me=e=>{if(!e.isOpen)return null;const t=e.steps[e.currentStep];if(t.modal)return(0,d.jsx)(o.Modal,{onRequestClose:e.closeModal,...t.modal.props,children:t.modal.content});if(t.cardGroups){const r=[...Object.keys(e.stepValues)].pop(),n=e.isLastStep?void 0:r=>{t.arg&&e.addQueryArg(t.arg,r)};return(0,d.jsx)(Y,{title:e.currentTitle,closeModal:e.closeModal,isOpen:e.isOpen,back:r&&!e.isFirstStep?()=>e.removeQueryArgs(e.steps[r]?.arg||""):void 0,cardGroups:"function"==typeof t.cardGroups?t.cardGroups(e.stepValues):t.cardGroups,licenseDetails:e.licenseDetails,onSelect:n,hrefCallback:t.arg&&e.isLastStep?r=>e.withQueryArg(t.arg,r):void 0,campaign:e.currentTitle,medium:e.medium,searchPlaceholder:t.searchPlaceholder,showSearch:!!t.searchPlaceholder},t.title)}return null},_e=({buttonProps:e,...t})=>{const[r,n]=(0,a.useState)(!1),s=(0,a.useCallback)(()=>{n(!0)},[n]),i=(0,a.useCallback)(()=>{n(!1)},[n]),l=t.currentStep&&t.hasSteps,c={...e,onClick:l?s:void 0,href:l?void 0:t.url};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(o.Button,{...c}),(0,d.jsx)(me,{isOpen:r,closeModal:i,...t})]})},xe=({text:e})=>{const t=(()=>{const e=(0,a.useContext)(J);if(!e)throw new Error("useModal must be used within a ModalProvider");return e})();return(0,d.jsx)(_e,{licenseDetails:K.license||{},buttonProps:{variant:"primary",type:"button",text:e||(0,l.__)("Add New Automation","newsletter-optin-box")},...t})},he=({text:e})=>(0,d.jsx)(X,{children:(0,d.jsx)(xe,{text:e})}),ge=({children:e})=>{const{automationRule:{trigger_id:t,action_id:r}}=b(),n=L(t,window.noptinEmailSettingsMisc?.triggers?.[t]?.category),[s,a]=P({heading:(0,l.__)("Unlock Premium Feature","newsletter-optin-box"),helpText:(0,l.__)("This automation trigger is only available to premium license holders.","newsletter-optin-box"),needsAddonsPack:!1,utm:{utm_medium:"Automation Rules",utm_campaign:"Premium Trigger",utm_term:t,utm_content:r}});return!s&&n?a:e};function be(){const{automationRule:{id:e}}=b(),t=!!(e&&e>0);return(0,d.jsxs)(o.__experimentalHStack,{justify:"flex-start",children:[(0,d.jsx)(o.__experimentalText,{as:"h1",size:23,weight:500,children:t?(0,l.__)("Edit Automation Rule","newsletter-optin-box"):(0,l.__)("Add Automation Rule","newsletter-optin-box")}),t&&(0,d.jsx)(he,{text:(0,l.__)("Add New","newsletter-optin-box")})]})}function je({automationRule:e}){return(0,d.jsx)("div",{className:"noptin-automation-rule__editor",children:(0,d.jsx)(G,{children:(0,d.jsx)(o.SlotFillProvider,{children:(0,d.jsx)(j,{automationRule:e,children:(0,d.jsx)(ge,{children:(0,d.jsx)(Q,{children:(0,d.jsxs)(o.__experimentalVStack,{spacing:4,children:[(0,d.jsx)(be,{}),(0,d.jsxs)(o.Flex,{wrap:!0,align:"top",children:[(0,d.jsx)(o.FlexBlock,{className:"noptin-es6-editor__main",children:(0,d.jsx)(W,{})}),(0,d.jsx)(o.FlexItem,{className:"noptin-component-editor__sidebar",style:{width:"300px"},children:(0,d.jsxs)(o.__experimentalVStack,{spacing:8,children:[(0,d.jsx)(z,{}),(0,d.jsx)(w,{})]})})]})]})})})})})})})}var ye=r(5338);const we=e=>{const t=window.noptinEmailSettingsMisc?.data?.app||{};return(0,d.jsx)(ne.StrictMode,{children:(0,d.jsx)(G,{children:(0,d.jsx)(je,{...e,...t})})})};s()(()=>{((e,t)=>{if(t){const r=t.getAttribute("data-app"),n=r?JSON.parse(r):{};(0,ye.H)(t).render((0,d.jsx)(e,{...n}))}})(we,document.getElementById("noptin-automation-rule__editor-app"))})}},r={};function n(e){var s=r[e];if(void 0!==s)return s.exports;var a=r[e]={exports:{}};return t[e](a,a.exports,n),a.exports}n.m=t,e=[],n.O=(t,r,s,a)=>{if(!r){var i=1/0;for(u=0;u<e.length;u++){for(var[r,s,a]=e[u],o=!0,l=0;l<r.length;l++)(!1&a||i>=a)&&Object.keys(n.O).every(e=>n.O[e](r[l]))?r.splice(l--,1):(o=!1,a<i&&(i=a));if(o){e.splice(u--,1);var c=s();void 0!==c&&(t=c)}}return t}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[r,s,a]},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={180:0,856:0};n.O.j=t=>0===e[t];var t=(t,r)=>{var s,a,[i,o,l]=r,c=0;if(i.some(t=>0!==e[t])){for(s in o)n.o(o,s)&&(n.m[s]=o[s]);if(l)var u=l(n)}for(t&&t(r);c<i.length;c++)a=i[c],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return n.O(u)},r=globalThis.webpackChunknoptin_premium=globalThis.webpackChunknoptin_premium||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var s=n.O(void 0,[856],()=>n(9844));s=n.O(s)})();