(()=>{"use strict";var e,t={475:(e,t,r)=>{const a=window.wp.domReady;var n=r.n(a);const l=window.React,i=window.wp.i18n,o=window.noptinEmailSettingsMisc||{},s=(o.license,window.wp.url),c=window.wp.components,m=window.noptinEmailEditorSettings||{},u=window.noptinEmailSettingsMisc||{},p=(u.license,m.types||{}),d=(Object.keys(p).map((e=>({value:e,label:p[e].label}))),Object.keys(m.templates||{}).map((e=>({value:e,label:m.templates[e]}))),{utm_source:"Noptin Plugin Dashboard"});u.data?.plural_label&&(d.utm_medium=u.data?.plural_label);const _=u.license||{},g=(_.is_usable&&_.key,/_published|_unpublished|_deleted|_user_role$/),y=["noptin_subscriber_","delete_user","new_user","update_user","wp_login","after_password_reset","create_or_update_"],b=[["woocommerce","subscription"],["latest_","_digest"]],w=["WordPress Users"],E=["latest_posts_digest"],h=["periodic"],f=(e,t=void 0)=>{if(!e||E.includes(e))return!1;if(h.includes(e))return!0;if(t&&w.includes(t))return!0;if(b.some((t=>t.every((t=>e.includes(t))))))return!0;const r=e.replace(/^automation_rule_/,"");return g.test(r)?"post_published"!==r:y.some((e=>r.startsWith(e)))};function v(e,t){const r={};Array.isArray(e)||Object.entries(e).forEach((([e,a])=>{if("email"!==e){if(!a.category){if(!o.isTest)return;a.category="Deprecated"}r[a.category]||(r[a.category]={}),r[a.category][e]={...a,selectText:"triggers"===t?(0,i.__)("Use trigger","newsletter-optin-box"):(0,i.__)("Set-up","newsletter-optin-box"),forcePremium:f(e,a.category)},a.image&&a.image.icon&&["category","editor-table"].includes(a.image.icon)&&(r[a.category][e].forcePremium=!0),a.alt_category&&(r[a.alt_category]||(r[a.alt_category]={}),r[a.alt_category][e]=r[a.category][e])}})),Array.isArray(o.integrations)&&o.integrations.forEach((a=>{a.plan&&"free"!==a.plan&&a[t]&&!Array.isArray(a[t])&&Object.entries(a[t]).forEach((([t,n])=>{n.forEach((({id:n,label:l,description:i,premium:o=!1})=>{if("premium"===a.plan||o)if(e[n]){const t=e[n].category;t&&r[t][n]&&(r[t][n].forcePremium=!0)}else r[t]||(r[t]={}),r[t][n]={name:n,label:l,description:i,category:t,image:a.icon_url,forcePremium:!0,is_installed:!1,installation:a.installation}}))}))}));const a={},n=(0,i.__)("General","newsletter-optin-box");return r.hasOwnProperty(n)&&(a[n]=r[n]),Object.keys(r).sort().forEach((e=>{e!==n&&(a[e]=r[e])})),a}const x={"noptin-trigger":{title:(0,i.__)("Select a trigger for your automation rule","newsletter-optin-box"),show:!0,arg:"noptin-trigger",cardGroups:v(o.data?.triggers||{},"triggers")},"noptin-action":{title:(0,i.__)("Select an action for your automation rule","newsletter-optin-box"),show:!0,arg:"noptin-action",cardGroups:v(o.data?.actions||{},"actions")}},k=(0,l.createContext)(void 0),S=({children:e})=>{const[t,r]=(0,l.useState)(o.data?.add_new||(0,s.addQueryArgs)(window.location.href,{noptin_edit_automation_rule:"0"})),a=(0,l.useMemo)((()=>{let e="";const a={};for(const[r,n]of Object.entries(x)){const l=n.arg?(0,s.getQueryArg)(t,n.arg):"";if(!l){e=r;break}a[r]=l}return{currentTitle:x[e]?.title||"",currentStep:e,isLastStep:e===Object.keys(x).pop(),isFirstStep:e===Object.keys(x)[0],hasSteps:Object.keys(x).length>0,stepValues:a,steps:x,campaign:"automation-rules",removeQueryArgs:(...e)=>{r((0,s.removeQueryArgs)(t,...e))},addQueryArg:(e,a)=>{r((0,s.addQueryArgs)(t,{[e]:a}))},withQueryArg:(e,r)=>(0,s.addQueryArgs)(t,{[e]:r}),url:t}}),[t,r]);return(0,l.createElement)(k.Provider,{value:a},e)},C=({title:e,isOpen:t,closeModal:r,back:a,...n})=>{const o=(0,l.createElement)(l.Fragment,null,a&&(0,l.createElement)(c.Button,{icon:"arrow-left-alt",onClick:a,label:(0,i.__)("Back","newsletter-optin-box"),showTooltip:!0}));return(0,l.createElement)(l.Fragment,null,t&&(0,l.createElement)(c.Modal,{title:e,onRequestClose:r,headerActions:o,isFullScreen:!0},(0,l.createElement)(z,{...n})))};function O(e){var t,r,a="";if("string"==typeof e||"number"==typeof e)a+=e;else if("object"==typeof e)if(Array.isArray(e)){var n=e.length;for(t=0;t<n;t++)e[t]&&(r=O(e[t]))&&(a&&(a+=" "),a+=r)}else for(r in e)e[r]&&(a&&(a+=" "),a+=r);return a}const A=function(){for(var e,t,r=0,a="",n=arguments.length;r<n;r++)(e=arguments[r])&&(t=O(e))&&(a&&(a+=" "),a+=t);return a},T=window.wp.compose,B={borderRadius:"5px"},M=({categories:e,selectedCategory:t,onClickCategory:r})=>{const a="noptin-campaign-explorer__sidebar",n=(0,T.useViewportMatch)("medium","<");return(0,l.createElement)(c.__experimentalSurface,{className:a,variant:n?"primary":"secondary",style:B},!n&&(0,l.createElement)(c.__experimentalElevation,{value:2}),(0,l.createElement)(c.NavigableMenu,{className:`${a}__categories-list`,orientation:n?"horizontal":"vertical",onNavigate:t=>r(e[t])},e.map((e=>(0,l.createElement)(c.Button,{key:e,label:e,text:e,className:`${a}__categories-list__item`,isPressed:t===e,onClick:()=>r(e)})))))},j=(window.wp.element,({image:e,title:t})=>{if("string"==typeof e&&e.startsWith("http"))return(0,l.createElement)("img",{src:e,width:24,alt:t,style:{maxWidth:24,height:"auto"}});if(e&&"string"==typeof e)return(0,l.createElement)(c.Icon,{size:24,icon:e,style:{color:"#424242"}});if(e&&"object"==typeof e){const t=e.fill||"#008000",r=e.path||"",a=e.viewBox||"0 0 24 24";return e.path?(0,l.createElement)(c.SVG,{viewBox:a,xmlns:"http://www.w3.org/2000/svg",style:{maxWidth:24}},(0,l.createElement)(c.Path,{fill:t,d:r})):(0,l.createElement)(c.Icon,{size:24,style:{color:t},icon:e.icon})}return(0,l.createElement)(c.Icon,{size:24,icon:"email",style:{color:"#424242"}})}),N=({learnMoreUrl:e,previewURL:t,action:r})=>{const[a,n]=(0,l.useState)(!1),[o,s]=(0,l.useState)(!0),m=()=>n(!1);return e?(0,l.createElement)(c.Button,{variant:"secondary",href:e,target:"_blank"},(0,l.createElement)("span",{className:"noptin-selectable-card-action__label"},(0,i.__)("Learn More"))," ",(0,l.createElement)(c.Icon,{size:16,icon:"arrow-right-alt"})):t?(0,l.createElement)(l.Fragment,null,(0,l.createElement)(c.Button,{variant:"secondary",onClick:()=>n(!0)},(0,l.createElement)("span",{className:"noptin-selectable-card-action__label"},(0,i.__)("Preview"))," ",(0,l.createElement)(c.Icon,{size:16,icon:"visibility"})),a&&(0,l.createElement)(c.Modal,{title:(0,i.__)("Preview"),onRequestClose:m,className:"noptin-preview-modal",headerActions:(0,l.createElement)(c.__experimentalHStack,{justify:"flex-end",wrap:!0},r,(0,l.createElement)(c.Button,{variant:r?"secondary":"primary",onClick:m},(0,i.__)("Back to templates"))),isDismissible:!1,isFullScreen:!0},o&&(0,l.createElement)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"}},(0,l.createElement)(c.Spinner,null)),(0,l.createElement)("iframe",{src:t,style:{width:"100%",height:"100%",border:"none",display:o?"none":"block"},onLoad:()=>s(!1)}))):null},D=({name:e,label:t,description:r,image:a,useValue:n,onSelect:o,hrefCallback:m,href:u,isTemplate:p,...d})=>{const _=void 0===n?e:n,g=(e=>{if(e.forcePremium?!1!==e.is_installed&&e?.licenseDetails?.key:!1!==e.is_installed){const t=e.primary||(0,l.createElement)(c.Button,{variant:"primary",onClick:e.onClick,href:e.href},(0,l.createElement)("span",{className:"noptin-selectable-card__label"},e.selectText||(0,i.__)("Select"))," ",(0,l.createElement)(c.Icon,{size:16,icon:"arrow-right-alt"}));return{upgradeText:null,button:t,secondaryButton:(0,l.createElement)(N,{learnMoreUrl:e.learnMoreUrl,previewURL:e.previewURL,action:t})}}const t=(t,r)=>!1===e.is_installed&&e.installation?.[t]?e.installation?.[t]:e.licenseDetails[t]||r,r=t("install_desc",(0,i.__)("Activate your license key to unlock","newsletter-optin-box")),a=t("install_text",(0,i.__)("View Pricing","newsletter-optin-box")),n=t("install_url",(0,s.addQueryArgs)("https://noptin.com/pricing/",{utm_source:"Noptin Plugin Dashboard",utm_medium:e.medium||void 0,utm_campaign:e.campaign||"noptin",utm_term:e.name||void 0})),o=(0,l.createElement)(c.Button,{variant:"primary",href:n,target:"_blank"},(0,l.createElement)("span",{className:"noptin-selectable-card-action__label"},a)," ",(0,l.createElement)(c.Icon,{size:16,icon:"lock"})),m=!e.licenseDetails?.key&&(0,l.createElement)(c.Button,{variant:"secondary",href:e.licenseDetails?.activate_url},(0,l.createElement)("span",{className:"noptin-selectable-card-action__label"},(0,i.__)("Activate"))," ",(0,l.createElement)(c.Icon,{size:16,icon:"unlock"}));return{upgradeText:r,button:o,secondaryButton:e.licenseDetails?.key||e.previewURL?(0,l.createElement)(N,{learnMoreUrl:e.learnMoreUrl,previewURL:e.previewURL,action:[o,m]}):m}})({onClick:(0,l.useCallback)((()=>o?o(_):null),[_,o]),name:e.replace("automation_rule_",""),href:m?m(_):u,...d}),y=A("noptin-selectable-card",`noptin-selectable-card__${_}`,p&&"noptin-selectable-card--template");return(0,l.createElement)(c.Card,{className:y,size:"small"},(0,l.createElement)(c.CardHeader,null,(0,l.createElement)(c.__experimentalHeading,{level:4,numberOfLines:1},t),(0,l.createElement)(j,{image:a,title:t})),p&&a?(0,l.createElement)(l.Fragment,null,(0,l.createElement)("div",{className:"noptin-template-preview__image-wrapper"},(0,l.createElement)("img",{src:a,alt:t,className:"noptin-template-preview__image"})),(0,l.createElement)(c.CardBody,null,g.upgradeText&&(0,l.createElement)(c.__experimentalText,{as:"em",isDestructive:!0},g.upgradeText))):(0,l.createElement)(c.CardBody,{style:{flexGrow:1}},(0,l.createElement)(c.__experimentalVStack,{spacing:4},r&&(0,l.createElement)(c.__experimentalText,{as:"p",variant:"muted"},r),p&&!a&&(0,l.createElement)(c.__experimentalText,{as:"em",variant:"muted"},(0,i.__)("No preview available","newsletter-optin-box")),g.upgradeText&&(0,l.createElement)(c.__experimentalText,{as:"em",isDestructive:!0},g.upgradeText))),(0,l.createElement)(c.CardFooter,{isBorderless:!0,justify:g.secondaryButton?"space-between":"flex-end"},g.secondaryButton,g.button),(0,l.createElement)(c.__experimentalElevation,{value:1,hover:3}))},P=["xhuge","huge","wide","xlarge","medium"],I=({showTitle:e,showSidebar:t,selectedCategory:r,cards:a,...n})=>{const i=P.map((e=>(0,T.useViewportMatch)(e,">="))).filter((e=>e)).length||1,o="noptin-campaign-explorer";let s=Object.entries(a);s.some((([,e])=>e.isTemplate))||s.sort(((e,t)=>{const r=["latest_posts_digest","periodic","manual_recipients"],a=r.includes(e[0])||e[1].orderFirst,n=r.includes(t[0])||t[1].orderFirst;return a&&!n?-1:!a&&n?1:e[1].label.localeCompare(t[1].label)}));const m=s.reduce(((e,[t,r])=>(r.forcePremium&&!n.licenseDetails?.key?e[1].push([t,r]):e[0].push([t,r]),e)),[[],[]]);return(0,l.createElement)(c.FlexBlock,{className:`${o}__list`},e&&(0,l.createElement)(c.__experimentalHeading,{level:2,lineHeight:"48px",className:`${o}__category-name`},r),(0,l.createElement)(c.__experimentalGrid,{role:"listbox",className:`${o}-list`,columns:t&&i>1?i-1:i,rowGap:32,columnGap:32},m[0].map((([e,t])=>(0,l.createElement)(D,{key:e,name:e,...n,...t}))),m[1].map((([e,t])=>(0,l.createElement)(D,{key:e,name:e,...n,...t})))))},R=({children:e,showSidebar:t,...r})=>{const a=(0,T.useViewportMatch)("medium","<");return t?a?(0,l.createElement)(c.__experimentalVStack,{spacing:4,...r},e):(0,l.createElement)(c.__experimentalHStack,{spacing:4,...r,justify:"stretch",alignment:"start",style:{maxHeight:"100%"}},e):(0,l.createElement)("div",{...r},e)},z=({cardGroups:e,...t})=>{const r=(0,l.useMemo)((()=>Object.keys(e)),[e]),a=r.length,[n,i]=(0,l.useState)(r[0]||"");(0,l.useEffect)((()=>{a>0&&!e[n]&&i(Object.keys(e)[0])}),[e,n]);const o=a>1,s=(0,l.useMemo)((()=>e[n]||{}),[e,n]),c=A("noptin-campaign-explorer",{"noptin-campaign-explorer--show-sidebar":o});return(0,l.createElement)(R,{className:c,showSidebar:o},o&&(0,l.createElement)(M,{selectedCategory:n,categories:r,onClickCategory:i}),(0,l.createElement)(I,{showTitle:o,showSidebar:o,selectedCategory:n,cards:s,...t}))},L=e=>{if(!e.isOpen)return null;const t=e.steps[e.currentStep];if(t.modal)return(0,l.createElement)(c.Modal,{onRequestClose:e.closeModal,...t.modal.props},t.modal.content);if(t.cardGroups){const r=[...Object.keys(e.stepValues)].pop(),a=e.isLastStep?void 0:r=>{t.arg&&e.addQueryArg(t.arg,r)};return(0,l.createElement)(C,{title:e.currentTitle,closeModal:e.closeModal,isOpen:e.isOpen,back:r&&!e.isFirstStep?()=>e.removeQueryArgs(e.steps[r]?.arg||""):void 0,cardGroups:"function"==typeof t.cardGroups?t.cardGroups(e.stepValues):t.cardGroups,licenseDetails:e.licenseDetails,onSelect:a,hrefCallback:t.arg&&e.isLastStep?r=>e.withQueryArg(t.arg,r):void 0,campaign:e.currentTitle,medium:e.medium,key:t.title})}return null},F=({buttonProps:e,...t})=>{const[r,a]=(0,l.useState)(!1),n=(0,l.useCallback)((()=>{a(!0)}),[a]),i=(0,l.useCallback)((()=>{a(!1)}),[a]),o=t.currentStep&&t.hasSteps,s={...e,onClick:o?n:void 0,href:o?void 0:t.url};return(0,l.createElement)(l.Fragment,null,(0,l.createElement)(c.Button,{...s}),(0,l.createElement)(L,{isOpen:r,closeModal:i,...t}))},G=({text:e})=>{const t=(()=>{const e=(0,l.useContext)(k);if(!e)throw new Error("useModal must be used within a ModalProvider");return e})();return(0,l.createElement)(F,{licenseDetails:o.license||{},buttonProps:{variant:"primary",type:"button",text:e||(0,i.__)("Add New Automation","newsletter-optin-box")},...t})},H=({text:e})=>(0,l.createElement)(S,null,(0,l.createElement)(G,{text:e})),U=()=>(0,l.createElement)(c.__experimentalVStack,{alignment:"center",justify:"center",spacing:6,style:{minHeight:320}},(0,l.createElement)(c.Icon,{icon:"admin-generic",size:100,style:{color:"#646970"}}),(0,l.createElement)(c.__experimentalText,{align:"center",color:"#646970",size:16,isBlock:!0},(0,i.__)('Automation rules are simple "if this, then that" commands. Trigger an action when a product is purchased, a user creates an account, someone is tagged, etc.',"newsletter-optin-box")),(0,l.createElement)(H,{text:(0,i.__)("Create your first automation rule","newsletter-optin-box")}),(0,l.createElement)(c.__experimentalText,{align:"center",size:14,isBlock:!0},(0,l.createElement)("a",{href:"https://noptin.com/guide/automation-rules/",style:{color:"#646970"},target:"_blank"},(0,i.__)("Or Learn more","newsletter-optin-box")))),V=window.wp.apiFetch;var Q=r.n(V);const $=({ruleId:e})=>{const[t,r]=(0,l.useState)(!1);return(0,l.createElement)(l.Fragment,null,(0,l.createElement)(c.Button,{icon:"trash",size:"compact",showTooltip:!0,label:(0,i.__)("Delete","newsletter-optin-box"),type:"button",onClick:()=>r(!0),isDestructive:!0}),t&&(0,l.createElement)(c.Modal,{onRequestClose:()=>r(!1),title:(0,i.__)("Delete Rule","newsletter-optin-box"),size:"small"},(0,l.createElement)(c.__experimentalVStack,{spacing:4},(0,l.createElement)(c.__experimentalText,null,(0,i.__)("Are you sure you want to delete this automation rule?","newsletter-optin-box")),(0,l.createElement)(c.__experimentalHStack,{spacing:4,justify:"flex-start",alignment:"flex-start"},(0,l.createElement)(c.Button,{variant:"primary",text:(0,i.__)("Delete","newsletter-optin-box"),type:"button",onClick:()=>{r(!1);const t=document.querySelector(`.noptin_automation_rule_${e}`);t&&t.classList.add("noptin-fade-out"),Q()({path:`/noptin/v1/automation_rules/${e}`,method:"DELETE"}).then((e=>(t&&t.remove(),e))).catch((e=>{alert(e.message),t&&t.classList.remove("noptin-fade-out")}))},isDestructive:!0}),(0,l.createElement)(c.Button,{variant:"secondary",text:(0,i.__)("Cancel","newsletter-optin-box"),type:"button",onClick:()=>r(!1)})))))},q=({ruleId:e,status:t})=>{const[r,a]=(0,l.useState)(t);return(0,l.createElement)(c.ToggleControl,{checked:r,label:r?(0,i.__)("Active","newsletter-optin-box"):(0,i.__)("Inactive","newsletter-optin-box"),className:"noptin-toggle-button",onChange:()=>{a(!r),Q()({path:`/noptin/v1/automation_rules/${e}`,method:"PATCH",data:{status:!r}}).catch((e=>{alert(e.message),a(r)}))},__nextHasNoMarginBottom:!0})},W=e=>(0,l.createElement)(c.__experimentalHStack,{alignment:"center",justify:"flex-end",spacing:1},(0,l.createElement)(c.Button,{href:e.editUrl,label:(0,i.__)("Edit","newsletter-optin-box"),size:"compact",icon:"edit",showTooltip:!0}),(0,l.createElement)($,{ruleId:e.ruleId}),(0,l.createElement)(q,{ruleId:e.ruleId,status:e.status}));var J=r(338);const K=(e,t)=>{if(t){const r=t.getAttribute("data-app"),a=r?JSON.parse(r):{};(0,J.H)(t).render((0,l.createElement)(e,{...a}))}};n()((()=>{K(U,document.getElementById("noptin-automation-rules__editor--add-new__in-table")),document.querySelectorAll(".noptin-automation-rules__editor--add-new__button").forEach((e=>{K(H,e)})),document.querySelectorAll(".noptin-automation-rule-actions__app").forEach((e=>{K(W,e)}))}))},338:(e,t,r)=>{var a=r(795);t.H=a.createRoot,a.hydrateRoot},795:e=>{e.exports=window.ReactDOM}},r={};function a(e){var n=r[e];if(void 0!==n)return n.exports;var l=r[e]={exports:{}};return t[e](l,l.exports,a),l.exports}a.m=t,e=[],a.O=(t,r,n,l)=>{if(!r){var i=1/0;for(m=0;m<e.length;m++){r=e[m][0],n=e[m][1],l=e[m][2];for(var o=!0,s=0;s<r.length;s++)(!1&l||i>=l)&&Object.keys(a.O).every((e=>a.O[e](r[s])))?r.splice(s--,1):(o=!1,l<i&&(i=l));if(o){e.splice(m--,1);var c=n();void 0!==c&&(t=c)}}return t}l=l||0;for(var m=e.length;m>0&&e[m-1][2]>l;m--)e[m]=e[m-1];e[m]=[r,n,l]},a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={229:0,833:0};a.O.j=t=>0===e[t];var t=(t,r)=>{var n,l,i=r[0],o=r[1],s=r[2],c=0;if(i.some((t=>0!==e[t]))){for(n in o)a.o(o,n)&&(a.m[n]=o[n]);if(s)var m=s(a)}for(t&&t(r);c<i.length;c++)l=i[c],a.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return a.O(m)},r=self.webpackChunknoptin_premium=self.webpackChunknoptin_premium||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var n=a.O(void 0,[833],(()=>a(475)));n=a.O(n)})();