(()=>{"use strict";var e={};function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function n(e,n){if(e){if("string"==typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}}function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,l=[],s=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=a.call(n)).done)&&(l.push(r.value),l.length!==t);s=!0);}catch(e){c=!0,o=e}finally{try{if(!s&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return l}}(e,t)||n(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}e.n=t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},e.d=(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const o=window.React,a=window.wp.element,i=window.wp.components,l=window.wp.i18n,s=window.wp.domReady;var c=e.n(s);const u=window.wp.apiFetch;var p=e.n(u);function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function m(e,t,n){return r=function(e,t){if("object"!=f(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=f(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(t),(t="symbol"==f(r)?r:String(r))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e;var r}function b(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||n(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}const g=window.wp.primitives,y=(0,o.createElement)(g.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,o.createElement)(g.Path,{d:"M6.6 6L5.4 7l4.5 5-4.5 5 1.1 1 5.5-6-5.4-6zm6 0l-1.1 1 4.5 5-4.5 5 1.1 1 5.5-6-5.5-6z"}));var _={"==":function(e,t){return e==t},"===":function(e,t){return e===t},"!=":function(e,t){return e!=t},"!==":function(e,t){return e!==t},">":function(e,t){return e>t},">=":function(e,t){return e>=t},"<":function(e,t){return e<t},"<=":function(e,t){return e<=t},includes:function(e,t){return e.includes(t)},"!includes":function(e,t){return!e.includes(t)},empty:function(e){return!e},"!empty":function(e){return e}},h=function(e,t,n){return!!_[t]&&_[t](e,n)},v=["setting","availableSmartTags","isPressEnterToChange"],w=["availableSmartTags","onMergeTagClick","raw","icon","label"],x=["setting","availableSmartTags","value","onChange"],E=["setting","value","options","onChange"];function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var C=["number","search","email","password","tel","url","date"];function k(e){var t=e.setting,n=e.availableSmartTags,r=e.isPressEnterToChange,l=d(e,v);void 0===r&&(r=!0);var s=P({availableSmartTags:n,onMergeTagClick:(0,a.useCallback)((function(e){l.onChange&&l.onChange(l.value?"".concat(l.value," ").concat(e).trim():e)}),[l.value,l.onChange])});return"string"==typeof l.suffix||l.suffix instanceof String?l.suffix=(0,o.createElement)(i.__experimentalInputControlSuffixWrapper,null,l.suffix):l.suffix=s,t.disabled&&(l.readOnly=!0,l.onFocus=function(e){return e.target.select()}),("string"==typeof l.prefix||l.prefix instanceof String)&&(l.prefix=(0,o.createElement)(i.__experimentalInputControlPrefixWrapper,null,l.prefix)),(0,o.createElement)(o.Fragment,null,(0,o.createElement)(i.__experimentalInputControl,S(S({},l),{},{type:C.includes(t.type)?t.type:"text",placeholder:t.placeholder?t.placeholder:"",isPressEnterToChange:r,__nextHasNoMarginBottom:!0,__next36pxDefaultSize:!0})))}var j=[{id:"key",label:(0,l.__)("Key","noptin-addons-pack"),type:"text"},{id:"value",label:(0,l.__)("Value","noptin-addons-pack"),type:"text"}];function P(e){var t=e.availableSmartTags,n=void 0===t?[]:t,r=e.onMergeTagClick,s=void 0===r?function(){}:r,c=e.raw,u=void 0!==c&&c,p=e.icon,f=void 0===p?"shortcode":p,m=e.label,b=void 0===m?(0,l.__)("Insert merge tag","newsletter-optin-box"):m,g=d(e,w),_=function(e){return(0,a.useMemo)((function(){if(!Array.isArray(e))return{};var t={};return e.forEach((function(e){var n=e.group?e.group:(0,l.__)("General","newsletter-optin-box");Array.isArray(t[n])||(t[n]=[]),t[n].push(e)})),t}),[e])}(n),h=Object.keys(_).length,v=null;return h>0&&(v=(0,o.createElement)(i.DropdownMenu,S({icon:f,label:b},g),(function(e){var t=e.onClose;return(0,o.createElement)(o.Fragment,null,Object.keys(_).map((function(e,n){return(0,o.createElement)(i.MenuGroup,{label:h>1?e:void 0,key:n},_[e].map((function(e){return(0,o.createElement)(i.MenuItem,{icon:e.icon||y,iconPosition:"left",onClick:function(){if(s){var n=u?e.smart_tag:"[[".concat((r=e).example?r.example:r.default?"".concat(r.smart_tag,' default="').concat(r.default,'"'):"".concat(r.smart_tag),"]]");s(n)}var r;t()},key:e.smart_tag},e.label)})))})))}))),v}function T(e){var t=e.setting,n=e.availableSmartTags,r=e.value,s=e.onChange,c=d(e,x),u=(0,i.useBaseControlProps)(c),p=u.baseControlProps,f=u.controlProps;Array.isArray(r)||(r=[]);var m=(0,a.useCallback)((function(e){var t=e.item,a=e.index;return(0,o.createElement)(i.Flex,{className:"noptin-repeater-item",wrap:!0},j.map((function(e,i){return(0,o.createElement)(A,{key:i,availableSmartTags:n,field:e,value:void 0===t[e.id]?"":t[e.id],onChange:function(t){var n=b(r);n[a][e.id]=t,s(n)}})})),(0,o.createElement)(i.FlexItem,null,(0,o.createElement)(i.Button,{icon:"trash",variant:"tertiary",className:"noptin-component__field",label:(0,l.__)("Delete","noptin-addons-pack"),showTooltip:!0,onClick:function(){var e=b(r);e.splice(a,1),s(e)},isDestructive:!0})))}),[r,s]);return(0,o.createElement)(i.BaseControl,S({},p),(0,o.createElement)("div",S({},f),r.map((function(e,t){return(0,o.createElement)(m,{key:t,item:e,index:t})})),(0,o.createElement)(i.Button,{onClick:function(){var e=b(r);e.push({}),s(e)},variant:"secondary"},t.add_field?t.add_field:(0,l.__)("Add","newsletter-optin-box"))))}function A(e){var t=e.field,n=e.availableSmartTags,r=e.value,s=e.onChange,c=P({availableSmartTags:n,onMergeTagClick:(0,a.useCallback)((function(e){s&&s(r?"".concat(r," ").concat(e).trim():e)}),[r,s])});return(0,o.createElement)(i.FlexBlock,null,(0,o.createElement)(i.__experimentalInputControl,{label:t.label,type:t.type,value:r,placeholder:(0,l.sprintf)((0,l.__)("Enter %s","noptin-addons-pack"),t.label),className:"noptin-component__field noptin-condition-field",suffix:c,onChange:s,isPressEnterToChange:!0,__nextHasNoMarginBottom:!0,__next36pxDefaultSize:!0}))}function B(e){e.setting;var t=e.value,n=e.options,r=e.onChange,a=d(e,E),l=(0,i.useBaseControlProps)(a),s=l.baseControlProps,c=l.controlProps;return Array.isArray(t)||(t=[]),(0,o.createElement)(i.BaseControl,S({},s),(0,o.createElement)("div",S({},c),n.map((function(e,n){return(0,o.createElement)(i.CheckboxControl,{key:n,label:e.label,checked:t.includes(e.value),onChange:function(n){r(n?[].concat(b(t),[e.value]):t.filter((function(t){return t!==e.value})))}})}))))}function D(e){var t=e.settingKey,n=e.setting,r=e.availableSmartTags,s=e.prop,c=e.saved,u=e.setAttributes,p=(0,a.useCallback)((function(e){if(!s)return u(m({},t,e));var n=c[s]?c[s]:{},r=m({},s,S(S({},n),{},m({},t,e)));u(r)}),[t,s,c,u]);if(n.if||n.restrict){var f=n.restrict?n.restrict.split("."):n.if.split(".");if(!(2!==f.length||c[f[0]]&&c[f[0]][f[1]]))return null;if(1===f.length&&!c[f[0]])return null}if(Array.isArray(n.conditions)){var b=n.conditions.every((function(e){var t=e.key.split("."),n=e.operator?e.operator:"==",r=c[t[0]];return 2===t.length?r&&r[t[1]]&&h(e.value,n,r[t[1]]):h(e.value,n,r)}));if(!b)return null}if(n.condition&&!n.condition(c))return null;var d=c[t];s&&(d=c[s]?c[s][t]:void 0),(void 0===d||n.disabled)&&(d=n.default);var g=void 0!==d&&""!==d&&null!==d,y=[];n.options&&(y=Object.keys(n.options).map((function(e){return{label:n.options[e],value:e}})));var _=n.fullWidth?"noptin-component__field noptin-component__field-".concat(t):"noptin-component__field-lg noptin-component__field-".concat(t),v=n.description?(0,o.createElement)("span",{dangerouslySetInnerHTML:{__html:n.description}}):"",w=n.customAttributes?n.customAttributes:{},x=S({label:n.label,value:g?d:"",onChange:p,className:"".concat(_),help:v},w);return"select"===n.el?(y.unshift({label:n.placeholder?n.placeholder:(0,l.__)("Select an option","newsletter-optin-box"),value:"",disabled:!n.canSelectPlaceholder}),(0,o.createElement)(i.SelectControl,S(S({},x),{},{options:y,__nextHasNoMarginBottom:!0,__next36pxDefaultSize:!0}))):"form_token"===n.el?(0,o.createElement)(i.FormTokenField,S(S({},x),{},{value:Array.isArray(x.value)?x.value:[],suggestions:Array.isArray(n.suggestions)?n.suggestions:[],__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})):"multi_checkbox"===n.el||"multi_checkbox_alt"===n.el?(0,o.createElement)(B,S(S({},x),{},{options:y})):"input"===n.el?n.type&&["toggle","switch","checkbox","checkbox_alt"].includes(n.type)?(0,o.createElement)(i.ToggleControl,S(S({},x),{},{checked:!!g&&d,onChange:function(e){p(e)}})):(0,o.createElement)(k,S(S({},x),{},{setting:n,availableSmartTags:"trigger_settings"===s?[]:r,isPressEnterToChange:!n.isInputToChange})):"textarea"===n.el?(0,o.createElement)(i.TextareaControl,S(S({},x),{},{setting:n,placeholder:n.placeholder?n.placeholder:"",__nextHasNoMarginBottom:!0})):"paragraph"===n.el?(0,o.createElement)("div",{className:_},(0,o.createElement)(i.Tip,null,n.content)):"hero"===n.el?(0,o.createElement)("div",{className:_},(0,o.createElement)("h3",null,n.content)):"key_value_repeater"===n.el||"webhook_key_value_repeater"===n.el?(0,o.createElement)(T,S(S({},x),{},{setting:n,availableSmartTags:"trigger_settings"===s?[]:r})):t}function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function I(e){var t=e.title,n=e.description,s=e.settings,c=e.handler,u=e.saved,p=e.onClickNext,f=e.onClickBack,m=e.isLastStep,b=e.isFirstStep,d=s.reduce((function(e,t){return e[t.settingKey]=u[t.settingKey]?u[t.settingKey]:"",e}),{}),g=r((0,a.useState)(d),2),y=g[0],_=g[1];return(0,o.createElement)(o.Fragment,null,(0,o.createElement)(i.CardHeader,null,(0,o.createElement)("h3",null,t)),n&&(0,o.createElement)(i.CardBody,null,(0,o.createElement)(i.Tip,null,n)),(0,o.createElement)(i.CardBody,null,s.map((function(e,t){return(0,o.createElement)(D,{key:t,settingKey:e.settingKey,saved:y,setAttributes:function(e){return _(M(M({},y),e))},setting:e})}))),(0,o.createElement)(i.CardFooter,null,!b&&(0,o.createElement)(i.Button,{variant:"secondary",onClick:f},(0,o.createElement)(i.Icon,{icon:"arrow-left-alt2"}),(0,l.__)("Back","newsletter-optin-box")),!m&&(0,o.createElement)(i.Button,{variant:"primary",onClick:function(){return c(y,p)}},(0,l.__)("Next","newsletter-optin-box"),(0,o.createElement)(i.Icon,{icon:"arrow-right-alt2"}))))}function K(e,t){p()({path:"/noptin/v1/settings",method:"POST",data:{settings:e}}).catch((function(e){console.error(e)})),t(e)}var F=(0,l.__)("Thank You","newsletter-optin-box"),z=(0,l.__)("You have successfully subscribed to this newsletter.","newsletter-optin-box"),H=(0,l.__)("Unsubscribed","newsletter-optin-box"),R=(0,l.__)("You have been unsubscribed from this mailing list and won't receive any emails from us.","newsletter-optin-box"),Y=[{title:(0,l.__)("Newsletter subscriptions","newsletter-optin-box"),description:(0,l.__)("Let's get you started with Noptin. Configure your subscription preferences","newsletter-optin-box"),settings:[{settingKey:"success_message",label:(0,l.__)("Default Success Message","newsletter-optin-box"),el:"textarea",help:(0,l.__)("This is the message shown to people after they successfully sign up for your newsletter.","newsletter-optin-box"),placeholder:(0,l.__)("Thanks for subscribing to our newsletter","newsletter-optin-box")},{settingKey:"double_optin",label:(0,l.__)("Enable Double Opt-in","newsletter-optin-box"),el:"input",type:"toggle",help:(0,l.__)("Require users to confirm their email address before they are added to your list","newsletter-optin-box")},{settingKey:"pages_confirm_page_message",label:(0,l.__)("Confirmation Page Message","newsletter-optin-box"),el:"textarea",help:(0,l.__)("This is the message shown to people after they confirm their email address.","newsletter-optin-box"),placeholder:"<h1>".concat(F,"</h1>\n\n<p>").concat(z,"</p>"),if:"double_optin"},{settingKey:"pages_unsubscribe_page_message",label:(0,l.__)("Unsubscribe Page Message","newsletter-optin-box"),el:"textarea",help:(0,l.__)("This is the message shown to people after they unsubscribe from your newsletter.","newsletter-optin-box"),placeholder:"<h1>".concat(H,"</h1>\n\n<p>").concat(R,"</p>")}],handler:K},{title:(0,l.__)("Email Sending","newsletter-optin-box"),description:(0,l.__)("Who's the sender of the emails you'll be sending?","newsletter-optin-box"),settings:[{settingKey:"from_name",label:(0,l.__)('"From" Name',"newsletter-optin-box"),el:"input",type:"text",help:(0,l.__)("How the sender name appears in outgoing emails","newsletter-optin-box")},{settingKey:"from_email",label:(0,l.__)('"From" Email',"newsletter-optin-box"),el:"input",type:"email",help:(0,l.__)("How the sender email appears in outgoing emails","newsletter-optin-box")},{settingKey:"reply_to",label:(0,l.__)('"Reply-to" Email',"newsletter-optin-box"),el:"input",type:"email",help:(0,l.__)("Where replies to your emails should be sent","newsletter-optin-box")}],handler:K},{title:(0,l.__)("Newsletter","newsletter-optin-box"),description:(0,l.__)("Subscribe to our newsletter to get the latest news and updates.","newsletter-optin-box"),settings:[{settingKey:"noptin_signup_name",label:(0,l.__)("Your Name","newsletter-optin-box"),el:"input",type:"text"},{settingKey:"noptin_signup_email",label:(0,l.__)("Your Email Address","newsletter-optin-box"),el:"input",type:"email"}],handler:function(e,t){e.noptin_signup_email.length>0&&window.fetch("https://noptin.com/wp-json/noptin/v1/subscribers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.noptin_signup_email,name:e.noptin_signup_name,source:"settings-wizard"})}).catch((function(e){console.error(e)})),t(e)}}];function W(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function L(e){var t=e.saved,n=r((0,a.useState)(0),2),s=n[0],c=n[1],u=s===Y.length-1,p=0===s,f=Y[s]?Y[s]:null;return(0,o.createElement)(i.Card,{className:"noptin-settings-wizard noptin-component__section",style:{maxWidth:"520px"}},f&&(0,o.createElement)(I,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?W(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({onClickNext:function(){return c(s+1)},onClickBack:function(){return c(s-1)},isLastStep:u,isFirstStep:p,saved:t},f)),!f&&(0,o.createElement)(i.CardBody,null,(0,o.createElement)("h2",null,(0,l.__)("That's all!","newsletter-optin-box")),(0,o.createElement)("p",null,(0,l.__)("You have successfully completed the settings wizard. You can now go to the settings page to customize your opt-in box.","newsletter-optin-box")),(0,o.createElement)(i.Button,{variant:"primary",href:"https://noptin.com/guide/",target:"_blank"},(0,l.__)("Read Documentation","newsletter-optin-box"))))}var G=function(){var e=r((0,a.useState)({}),2),t=e[0],n=e[1],s=r((0,a.useState)(!0),2),c=s[0],u=s[1],f=r((0,a.useState)(!1),2),m=f[0],b=f[1];return(0,a.useEffect)((function(){p()({path:"/noptin/v1/settings"}).then((function(e){n(e)})).catch((function(e){b(e.message?e.message:(0,l.__)("An unknown error occurred.","noptin"))})).finally((function(){u(!1)}))}),[]),c?(0,o.createElement)(i.Spinner,null):m?(0,o.createElement)(i.Notice,{status:"error",isDismissible:!1},m):(0,o.createElement)(a.StrictMode,null,(0,o.createElement)(L,{saved:t}))};c()((function(){var e=document.getElementById("noptin-welcome-wizard");e&&(a.createRoot?(0,a.createRoot)(e).render((0,o.createElement)(G,null)):(0,a.render)((0,o.createElement)(G,null),e))}))})();