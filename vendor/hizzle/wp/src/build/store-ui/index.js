(()=>{var e,t={213:function(e,t,n){var r,s;void 0===(s="function"==typeof(r=function(){"use strict";function t(e,t,n){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="blob",r.onload=function(){o(r.response,t,n)},r.onerror=function(){console.error("could not download file")},r.send()}function r(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function s(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var i="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof n.g&&n.g.global===n.g?n.g:void 0,a=i.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),o=i.saveAs||("object"!=typeof window||window!==i?function(){}:"download"in HTMLAnchorElement.prototype&&!a?function(e,n,a){var o=i.URL||i.webkitURL,l=document.createElement("a");n=n||e.name||"download",l.download=n,l.rel="noopener","string"==typeof e?(l.href=e,l.origin===location.origin?s(l):r(l.href)?t(e,n,a):s(l,l.target="_blank")):(l.href=o.createObjectURL(e),setTimeout(function(){o.revokeObjectURL(l.href)},4e4),setTimeout(function(){s(l)},0))}:"msSaveOrOpenBlob"in navigator?function(e,n,i){if(n=n||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}(e,i),n);else if(r(e))t(e,n,i);else{var a=document.createElement("a");a.href=e,a.target="_blank",setTimeout(function(){s(a)})}}:function(e,n,r,s){if((s=s||open("","_blank"))&&(s.document.title=s.document.body.innerText="downloading..."),"string"==typeof e)return t(e,n,r);var o="application/octet-stream"===e.type,l=/constructor/i.test(i.HTMLElement)||i.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||o&&l||a)&&"undefined"!=typeof FileReader){var d=new FileReader;d.onloadend=function(){var e=d.result;e=c?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),s?s.location.href=e:location=e,s=null},d.readAsDataURL(e)}else{var u=i.URL||i.webkitURL,p=u.createObjectURL(e);s?s.location=p:location.href=p,s=null,setTimeout(function(){u.revokeObjectURL(p)},4e4)}});i.saveAs=o.saveAs=o,e.exports=o})?r.apply(t,[]):r)||(e.exports=s)},809:function(e,t){var n,r;n=function e(){var t,n="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n?n:{},r=!n.document&&!!n.postMessage,s=n.IS_PAPA_WORKER||!1,i={},a=0,o={};function l(e){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(e){var t=b(e);t.chunkSize=parseInt(t.chunkSize),e.step||e.chunk||(t.chunkSize=null),this._handle=new h(t),(this._handle.streamer=this)._config=t}.call(this,e),this.parseChunk=function(e,t){var r=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<r){let t=this._config.newline;t||(i=this._config.quoteChar||'"',t=this._handle.guessLineEndings(e,i)),e=[...e.split(t).slice(r)].join(t)}this.isFirstChunk&&j(this._config.beforeFirstChunk)&&void 0!==(i=this._config.beforeFirstChunk(e))&&(e=i),this.isFirstChunk=!1,this._halted=!1,r=this._partialLine+e;var i=(this._partialLine="",this._handle.parse(r,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(e=i.meta.cursor,this._finished||(this._partialLine=r.substring(e-this._baseIndex),this._baseIndex=e),i&&i.data&&(this._rowCount+=i.data.length),r=this._finished||this._config.preview&&this._rowCount>=this._config.preview,s)n.postMessage({results:i,workerId:o.WORKER_ID,finished:r});else if(j(this._config.chunk)&&!t){if(this._config.chunk(i,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=i=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(i.data),this._completeResults.errors=this._completeResults.errors.concat(i.errors),this._completeResults.meta=i.meta),this._completed||!r||!j(this._config.complete)||i&&i.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),r||i&&i.meta.paused||this._nextChunk(),i}this._halted=!0},this._sendError=function(e){j(this._config.error)?this._config.error(e):s&&this._config.error&&n.postMessage({workerId:o.WORKER_ID,error:e,finished:!1})}}function c(e){var t;(e=e||{}).chunkSize||(e.chunkSize=o.RemoteChunkSize),l.call(this,e),this._nextChunk=r?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(e){this._input=e,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),r||(t.onload=y(this._chunkLoaded,this),t.onerror=y(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!r),this._config.downloadRequestHeaders){var e,n=this._config.downloadRequestHeaders;for(e in n)t.setRequestHeader(e,n[e])}var s;this._config.chunkSize&&(s=this._start+this._config.chunkSize-1,t.setRequestHeader("Range","bytes="+this._start+"-"+s));try{t.send(this._config.downloadRequestBody)}catch(e){this._chunkError(e.message)}r&&0===t.status&&this._chunkError()}},this._chunkLoaded=function(){4===t.readyState&&(t.status<200||400<=t.status?this._chunkError():(this._start+=this._config.chunkSize||t.responseText.length,this._finished=!this._config.chunkSize||this._start>=(e=>null!==(e=e.getResponseHeader("Content-Range"))?parseInt(e.substring(e.lastIndexOf("/")+1)):-1)(t),this.parseChunk(t.responseText)))},this._chunkError=function(e){e=t.statusText||e,this._sendError(new Error(e))}}function d(e){(e=e||{}).chunkSize||(e.chunkSize=o.LocalChunkSize),l.call(this,e);var t,n,r="undefined"!=typeof FileReader;this.stream=function(e){this._input=e,n=e.slice||e.webkitSlice||e.mozSlice,r?((t=new FileReader).onload=y(this._chunkLoaded,this),t.onerror=y(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var e=this._input,s=(this._config.chunkSize&&(s=Math.min(this._start+this._config.chunkSize,this._input.size),e=n.call(e,this._start,s)),t.readAsText(e,this._config.encoding));r||this._chunkLoaded({target:{result:s}})},this._chunkLoaded=function(e){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(e.target.result)},this._chunkError=function(){this._sendError(t.error)}}function u(e){var t;l.call(this,e=e||{}),this.stream=function(e){return t=e,this._nextChunk()},this._nextChunk=function(){var e,n;if(!this._finished)return e=this._config.chunkSize,t=e?(n=t.substring(0,e),t.substring(e)):(n=t,""),this._finished=!t,this.parseChunk(n)}}function p(e){l.call(this,e=e||{});var t=[],n=!0,r=!1;this.pause=function(){l.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){l.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(e){this._input=e,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){r&&1===t.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):n=!0},this._streamData=y(function(e){try{t.push("string"==typeof e?e:e.toString(this._config.encoding)),n&&(n=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(e){this._streamError(e)}},this),this._streamError=y(function(e){this._streamCleanUp(),this._sendError(e)},this),this._streamEnd=y(function(){this._streamCleanUp(),r=!0,this._streamData("")},this),this._streamCleanUp=y(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function h(e){var t,n,r,s,i=Math.pow(2,53),a=-i,l=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,c=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,d=this,u=0,p=0,h=!1,g=!1,x=[],_={data:[],errors:[],meta:{}};function y(t){return"greedy"===e.skipEmptyLines?""===t.join("").trim():1===t.length&&0===t[0].length}function w(){if(_&&r&&(k("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+o.DefaultDelimiter+"'"),r=!1),e.skipEmptyLines&&(_.data=_.data.filter(function(e){return!y(e)})),v()){if(_)if(Array.isArray(_.data[0])){for(var t=0;v()&&t<_.data.length;t++)_.data[t].forEach(n);_.data.splice(0,1)}else _.data.forEach(n);function n(t,n){j(e.transformHeader)&&(t=e.transformHeader(t,n)),x.push(t)}}function s(t,n){for(var r=e.header?{}:[],s=0;s<t.length;s++){var o=s,d=t[s];d=((t,n)=>(t=>(e.dynamicTypingFunction&&void 0===e.dynamicTyping[t]&&(e.dynamicTyping[t]=e.dynamicTypingFunction(t)),!0===(e.dynamicTyping[t]||e.dynamicTyping)))(t)?"true"===n||"TRUE"===n||"false"!==n&&"FALSE"!==n&&((e=>{if(l.test(e)&&(e=parseFloat(e),a<e&&e<i))return 1})(n)?parseFloat(n):c.test(n)?new Date(n):""===n?null:n):n)(o=e.header?s>=x.length?"__parsed_extra":x[s]:o,d=e.transform?e.transform(d,o):d),"__parsed_extra"===o?(r[o]=r[o]||[],r[o].push(d)):r[o]=d}return e.header&&(s>x.length?k("FieldMismatch","TooManyFields","Too many fields: expected "+x.length+" fields but parsed "+s,p+n):s<x.length&&k("FieldMismatch","TooFewFields","Too few fields: expected "+x.length+" fields but parsed "+s,p+n)),r}var d;_&&(e.header||e.dynamicTyping||e.transform)&&(d=1,!_.data.length||Array.isArray(_.data[0])?(_.data=_.data.map(s),d=_.data.length):_.data=s(_.data,0),e.header&&_.meta&&(_.meta.fields=x),p+=d)}function v(){return e.header&&0===x.length}function k(e,t,n,r){e={type:e,code:t,message:n},void 0!==r&&(e.row=r),_.errors.push(e)}j(e.step)&&(s=e.step,e.step=function(t){_=t,v()?w():(w(),0!==_.data.length&&(u+=t.data.length,e.preview&&u>e.preview?n.abort():(_.data=_.data[0],s(_,d))))}),this.parse=function(s,i,a){var l=e.quoteChar||'"';return e.newline||(e.newline=this.guessLineEndings(s,l)),r=!1,e.delimiter?j(e.delimiter)&&(e.delimiter=e.delimiter(s),_.meta.delimiter=e.delimiter):((l=((t,n,r,s,i)=>{var a,l,c,d;i=i||[",","\t","|",";",o.RECORD_SEP,o.UNIT_SEP];for(var u=0;u<i.length;u++){for(var p,h=i[u],m=0,g=0,x=0,_=(c=void 0,new f({comments:s,delimiter:h,newline:n,preview:10}).parse(t)),b=0;b<_.data.length;b++)r&&y(_.data[b])?x++:(g+=p=_.data[b].length,void 0===c?c=p:0<p&&(m+=Math.abs(p-c),c=p));0<_.data.length&&(g/=_.data.length-x),(void 0===l||m<=l)&&(void 0===d||d<g)&&1.99<g&&(l=m,a=h,d=g)}return{successful:!!(e.delimiter=a),bestDelimiter:a}})(s,e.newline,e.skipEmptyLines,e.comments,e.delimitersToGuess)).successful?e.delimiter=l.bestDelimiter:(r=!0,e.delimiter=o.DefaultDelimiter),_.meta.delimiter=e.delimiter),l=b(e),e.preview&&e.header&&l.preview++,t=s,n=new f(l),_=n.parse(t,i,a),w(),h?{meta:{paused:!0}}:_||{meta:{paused:!1}}},this.paused=function(){return h},this.pause=function(){h=!0,n.abort(),t=j(e.chunk)?"":t.substring(n.getCharIndex())},this.resume=function(){d.streamer._halted?(h=!1,d.streamer.parseChunk(t,!0)):setTimeout(d.resume,3)},this.aborted=function(){return g},this.abort=function(){g=!0,n.abort(),_.meta.aborted=!0,j(e.complete)&&e.complete(_),t=""},this.guessLineEndings=function(e,t){e=e.substring(0,1048576),t=new RegExp(m(t)+"([^]*?)"+m(t),"gm");var n=(e=e.replace(t,"")).split("\r");if(e=1<(t=e.split("\n")).length&&t[0].length<n[0].length,1===n.length||e)return"\n";for(var r=0,s=0;s<n.length;s++)"\n"===n[s][0]&&r++;return r>=n.length/2?"\r\n":"\r"}}function m(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function f(e){var t=(e=e||{}).delimiter,n=e.newline,r=e.comments,s=e.step,i=e.preview,a=e.fastMode,l=null,c=!1,d=null==e.quoteChar?'"':e.quoteChar,u=d;if(void 0!==e.escapeChar&&(u=e.escapeChar),("string"!=typeof t||-1<o.BAD_DELIMITERS.indexOf(t))&&(t=","),r===t)throw new Error("Comment character same as delimiter");!0===r?r="#":("string"!=typeof r||-1<o.BAD_DELIMITERS.indexOf(r))&&(r=!1),"\n"!==n&&"\r"!==n&&"\r\n"!==n&&(n="\n");var p=0,h=!1;this.parse=function(o,f,g){if("string"!=typeof o)throw new Error("Input must be a string");var x=o.length,_=t.length,b=n.length,y=r.length,w=j(s),v=[],k=[],C=[],S=p=0;if(!o)return P();if(a||!1!==a&&-1===o.indexOf(d)){for(var z=o.split(n),E=0;E<z.length;E++){if(C=z[E],p+=C.length,E!==z.length-1)p+=n.length;else if(g)return P();if(!r||C.substring(0,y)!==r){if(w){if(v=[],T(C.split(t)),M(),h)return P()}else T(C.split(t));if(i&&i<=E)return v=v.slice(0,i),P(!0)}}return P()}for(var R=o.indexOf(t,p),A=o.indexOf(n,p),D=new RegExp(m(u)+m(d),"g"),F=o.indexOf(d,p);;)if(o[p]===d)for(F=p,p++;;){if(-1===(F=o.indexOf(d,F+1)))return g||k.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:v.length,index:p}),O();if(F===x-1)return O(o.substring(p,F).replace(D,d));if(d===u&&o[F+1]===u)F++;else if(d===u||0===F||o[F-1]!==u){-1!==R&&R<F+1&&(R=o.indexOf(t,F+1));var N=B(-1===(A=-1!==A&&A<F+1?o.indexOf(n,F+1):A)?R:Math.min(R,A));if(o.substr(F+1+N,_)===t){C.push(o.substring(p,F).replace(D,d)),o[p=F+1+N+_]!==d&&(F=o.indexOf(d,p)),R=o.indexOf(t,p),A=o.indexOf(n,p);break}if(N=B(A),o.substring(F+1+N,F+1+N+b)===n){if(C.push(o.substring(p,F).replace(D,d)),I(F+1+N+b),R=o.indexOf(t,p),F=o.indexOf(d,p),w&&(M(),h))return P();if(i&&v.length>=i)return P(!0);break}k.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:v.length,index:p}),F++}}else if(r&&0===C.length&&o.substring(p,p+y)===r){if(-1===A)return P();p=A+b,A=o.indexOf(n,p),R=o.indexOf(t,p)}else if(-1!==R&&(R<A||-1===A))C.push(o.substring(p,R)),p=R+_,R=o.indexOf(t,p);else{if(-1===A)break;if(C.push(o.substring(p,A)),I(A+b),w&&(M(),h))return P();if(i&&v.length>=i)return P(!0)}return O();function T(e){v.push(e),S=p}function B(e){return-1!==e&&(e=o.substring(F+1,e))&&""===e.trim()?e.length:0}function O(e){return g||(void 0===e&&(e=o.substring(p)),C.push(e),p=x,T(C),w&&M()),P()}function I(e){p=e,T(C),C=[],A=o.indexOf(n,p)}function P(r){if(e.header&&!f&&v.length&&!c){var s=v[0],i=Object.create(null),a=new Set(s);let t=!1;for(let n=0;n<s.length;n++){let r=s[n];if(i[r=j(e.transformHeader)?e.transformHeader(r,n):r]){let e,o=i[r];for(;e=r+"_"+o,o++,a.has(e););a.add(e),s[n]=e,i[r]++,t=!0,(l=null===l?{}:l)[e]=r}else i[r]=1,s[n]=r;a.add(r)}t&&console.warn("Duplicate headers found and renamed."),c=!0}return{data:v,errors:k,meta:{delimiter:t,linebreak:n,aborted:h,truncated:!!r,cursor:S+(f||0),renamedHeaders:l}}}function M(){s(P()),v=[],k=[]}},this.abort=function(){h=!0},this.getCharIndex=function(){return p}}function g(e){var t=e.data,n=i[t.workerId],r=!1;if(t.error)n.userError(t.error,t.file);else if(t.results&&t.results.data){var s={abort:function(){r=!0,x(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:_,resume:_};if(j(n.userStep)){for(var a=0;a<t.results.data.length&&(n.userStep({data:t.results.data[a],errors:t.results.errors,meta:t.results.meta},s),!r);a++);delete t.results}else j(n.userChunk)&&(n.userChunk(t.results,s,t.file),delete t.results)}t.finished&&!r&&x(t.workerId,t.results)}function x(e,t){var n=i[e];j(n.userComplete)&&n.userComplete(t),n.terminate(),delete i[e]}function _(){throw new Error("Not implemented.")}function b(e){if("object"!=typeof e||null===e)return e;var t,n=Array.isArray(e)?[]:{};for(t in e)n[t]=b(e[t]);return n}function y(e,t){return function(){e.apply(t,arguments)}}function j(e){return"function"==typeof e}return o.parse=function(t,r){var s=(r=r||{}).dynamicTyping||!1;if(j(s)&&(r.dynamicTypingFunction=s,s={}),r.dynamicTyping=s,r.transform=!!j(r.transform)&&r.transform,!r.worker||!o.WORKERS_SUPPORTED)return s=null,o.NODE_STREAM_INPUT,"string"==typeof t?(t=(e=>65279!==e.charCodeAt(0)?e:e.slice(1))(t),s=new(r.download?c:u)(r)):!0===t.readable&&j(t.read)&&j(t.on)?s=new p(r):(n.File&&t instanceof File||t instanceof Object)&&(s=new d(r)),s.stream(t);(s=(()=>{var t;return!!o.WORKERS_SUPPORTED&&(t=(()=>{var t=n.URL||n.webkitURL||null,r=e.toString();return o.BLOB_URL||(o.BLOB_URL=t.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",r,")();"],{type:"text/javascript"})))})(),(t=new n.Worker(t)).onmessage=g,t.id=a++,i[t.id]=t)})()).userStep=r.step,s.userChunk=r.chunk,s.userComplete=r.complete,s.userError=r.error,r.step=j(r.step),r.chunk=j(r.chunk),r.complete=j(r.complete),r.error=j(r.error),delete r.worker,s.postMessage({input:t,config:r,workerId:s.id})},o.unparse=function(e,t){var n=!1,r=!0,s=",",i="\r\n",a='"',l=a+a,c=!1,d=null,u=!1,p=((()=>{if("object"==typeof t){if("string"!=typeof t.delimiter||o.BAD_DELIMITERS.filter(function(e){return-1!==t.delimiter.indexOf(e)}).length||(s=t.delimiter),"boolean"!=typeof t.quotes&&"function"!=typeof t.quotes&&!Array.isArray(t.quotes)||(n=t.quotes),"boolean"!=typeof t.skipEmptyLines&&"string"!=typeof t.skipEmptyLines||(c=t.skipEmptyLines),"string"==typeof t.newline&&(i=t.newline),"string"==typeof t.quoteChar&&(a=t.quoteChar),"boolean"==typeof t.header&&(r=t.header),Array.isArray(t.columns)){if(0===t.columns.length)throw new Error("Option columns is empty");d=t.columns}void 0!==t.escapeChar&&(l=t.escapeChar+a),t.escapeFormulae instanceof RegExp?u=t.escapeFormulae:"boolean"==typeof t.escapeFormulae&&t.escapeFormulae&&(u=/^[=+\-@\t\r].*$/)}})(),new RegExp(m(a),"g"));if("string"==typeof e&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return h(null,e,c);if("object"==typeof e[0])return h(d||Object.keys(e[0]),e,c)}else if("object"==typeof e)return"string"==typeof e.data&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields||d),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:"object"==typeof e.data[0]?Object.keys(e.data[0]):[]),Array.isArray(e.data[0])||"object"==typeof e.data[0]||(e.data=[e.data])),h(e.fields||[],e.data||[],c);throw new Error("Unable to serialize unrecognized input");function h(e,t,n){var a="",o=("string"==typeof e&&(e=JSON.parse(e)),"string"==typeof t&&(t=JSON.parse(t)),Array.isArray(e)&&0<e.length),l=!Array.isArray(t[0]);if(o&&r){for(var c=0;c<e.length;c++)0<c&&(a+=s),a+=f(e[c],c);0<t.length&&(a+=i)}for(var d=0;d<t.length;d++){var u=(o?e:t[d]).length,p=!1,h=o?0===Object.keys(t[d]).length:0===t[d].length;if(n&&!o&&(p="greedy"===n?""===t[d].join("").trim():1===t[d].length&&0===t[d][0].length),"greedy"===n&&o){for(var m=[],g=0;g<u;g++){var x=l?e[g]:g;m.push(t[d][x])}p=""===m.join("").trim()}if(!p){for(var _=0;_<u;_++){0<_&&!h&&(a+=s);var b=o&&l?e[_]:_;a+=f(t[d][b],_)}d<t.length-1&&(!n||0<u&&!h)&&(a+=i)}}return a}function f(e,t){var r,i;return null==e?"":e.constructor===Date?JSON.stringify(e).slice(1,25):(i=!1,u&&"string"==typeof e&&u.test(e)&&(e="'"+e,i=!0),r=e.toString().replace(p,l),(i=i||!0===n||"function"==typeof n&&n(e,t)||Array.isArray(n)&&n[t]||((e,t)=>{for(var n=0;n<t.length;n++)if(-1<e.indexOf(t[n]))return!0;return!1})(r,o.BAD_DELIMITERS)||-1<r.indexOf(s)||" "===r.charAt(0)||" "===r.charAt(r.length-1))?a+r+a:r)}},o.RECORD_SEP=String.fromCharCode(30),o.UNIT_SEP=String.fromCharCode(31),o.BYTE_ORDER_MARK="\ufeff",o.BAD_DELIMITERS=["\r","\n",'"',o.BYTE_ORDER_MARK],o.WORKERS_SUPPORTED=!r&&!!n.Worker,o.NODE_STREAM_INPUT=1,o.LocalChunkSize=10485760,o.RemoteChunkSize=5242880,o.DefaultDelimiter=",",o.Parser=f,o.ParserHandle=h,o.NetworkStreamer=c,o.FileStreamer=d,o.StringStreamer=u,o.ReadableStreamStreamer=p,n.jQuery&&((t=n.jQuery).fn.parse=function(e){var r=e.config||{},s=[];return this.each(function(e){if("INPUT"!==t(this).prop("tagName").toUpperCase()||"file"!==t(this).attr("type").toLowerCase()||!n.FileReader||!this.files||0===this.files.length)return!0;for(var i=0;i<this.files.length;i++)s.push({file:this.files[i],inputElem:this,instanceConfig:t.extend({},r)})}),i(),this;function i(){if(0===s.length)j(e.complete)&&e.complete();else{var n,r,i,l=s[0];if(j(e.before)){var c=e.before(l.file,l.inputElem);if("object"==typeof c){if("abort"===c.action)return n=l.file,r=l.inputElem,i=c.reason,void(j(e.error)&&e.error({name:"AbortError"},n,r,i));if("skip"===c.action)return void a();"object"==typeof c.config&&(l.instanceConfig=t.extend(l.instanceConfig,c.config))}else if("skip"===c)return void a()}var d=l.instanceConfig.complete;l.instanceConfig.complete=function(e){j(d)&&d(e,l.file,l.inputElem),a()},o.parse(l.file,l.instanceConfig)}}function a(){s.splice(0,1),i()}}),s&&(n.onmessage=function(e){e=e.data,void 0===o.WORKER_ID&&e&&(o.WORKER_ID=e.workerId),"string"==typeof e.input?n.postMessage({workerId:o.WORKER_ID,results:o.parse(e.input,e.config),finished:!0}):(n.File&&e.input instanceof File||e.input instanceof Object)&&(e=o.parse(e.input,e.config))&&n.postMessage({workerId:o.WORKER_ID,results:e,finished:!0})}),(c.prototype=Object.create(l.prototype)).constructor=c,(d.prototype=Object.create(l.prototype)).constructor=d,(u.prototype=Object.create(u.prototype)).constructor=u,(p.prototype=Object.create(l.prototype)).constructor=p,o},void 0===(r=n.apply(t,[]))||(e.exports=r)},928:(e,t,n)=>{"use strict";const r=window.wp.domReady;var s=n.n(r);const i=window.wp.element,a=window.wp.components,o=window.wp.keyboardShortcuts,l=window.wp.data,c=window.React;var d=n.n(c);const u=window.wp.url,p=window.hizzlewp.interface,h=window.hizzlewp.components,m=window.hizzlewp.history,f=window.wp.notices,g=window.ReactJSXRuntime;function x(){const{notices:e}=(0,l.useSelect)(e=>({notices:e(f.store).getNotices()}),[]),{removeNotice:t}=(0,l.useDispatch)(f.store),n=e.filter(({isDismissible:e,type:t})=>e&&"default"===t),r=e.filter(({isDismissible:e,type:t})=>!e&&"default"===t);return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(a.NoticeList,{notices:r,className:"components-editor-notices__pinned"}),(0,g.jsx)(a.NoticeList,{notices:n,className:"components-editor-notices__dismissible",onRemove:t})]})}function _(){const e=(0,l.useSelect)(e=>e(f.store).getNotices(),[]),{removeNotice:t}=(0,l.useDispatch)(f.store),n=e.filter(({type:e})=>"snackbar"===e).slice(-3);return(0,g.jsx)(a.SnackbarList,{notices:n,className:"components-editor-notices__snackbar",onRemove:t})}const b=window.wp.primitives,y=(0,g.jsx)(b.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,g.jsx)(b.Path,{d:"M15.1 4.8l-3-2.5V4c-4.4 0-8 3.6-8 8 0 3.7 2.5 6.9 6 7.7.3.1.6.1 1 .2l.2-1.5c-.4 0-.7-.1-1.1-.2l-.1.2v-.2c-2.6-.8-4.5-3.3-4.5-6.2 0-3.6 2.9-6.5 6.5-6.5v1.8l3-2.5zM20 11c-.2-1.4-.7-2.7-1.6-3.8l-1.2.8c.7.9 1.1 2 1.3 3.1L20 11zm-1.5 1.8c-.1.5-.2 1.1-.4 1.6s-.5 1-.8 1.5l1.2.9c.4-.5.8-1.1 1-1.8s.5-1.3.5-2l-1.5-.2zm-5.6 5.6l.2 1.5c1.4-.2 2.7-.7 3.8-1.6l-.9-1.1c-.9.7-2 1.1-3.1 1.2z"})}),j=(0,g.jsx)(b.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,g.jsx)(b.Path,{d:"M20 11.2H6.8l3.7-3.7-1-1L3.9 12l5.6 5.5 1-1-3.7-3.7H20z"})}),w=window.hizzlewp.store,v=({children:e})=>(0,g.jsx)("div",{className:"hizzlewp-upsell-card",children:e}),k=({upsell:e})=>{if(!e)return null;const{content:t,buttonURL:n,buttonText:r}=e;return(0,g.jsx)(v,{children:(0,g.jsxs)(a.Tip,{children:[t,(0,g.jsx)(a.Button,{href:n,target:"_blank",variant:"link",children:r})]})})},C=window.wp.i18n,S=window.hizzlewp.records,z=window.wp.date;function E(e){if(["subscribed","subscribe","active","yes","true","1","complete"].includes(e))return{backgroundColor:"#78c67a",color:"#111111"};if(["unsubscribed","unsubscribe","inactive","no","false","0","canceled"].includes(e))return{backgroundColor:"#fbcfbd",color:"#241c15"};if(["pending","waiting","maybe","2"].includes(e))return{backgroundColor:"#fbeeca",color:"#241c15"};const t=(0,h.stringToColor)(e,{saturation:[60,100],lightness:[30,45]});return{backgroundColor:t.color,color:t.isLight?"#111111":"#ffffff"}}const R=e=>{const{className:t,...n}=e;return(0,g.jsx)("span",{className:`hizzlewp-badge ${t||""}`,...n})},A=(e,t,n=!1)=>{if(!e)return e;n&&(e=(0,u.addQueryArgs)(e,{s:360}));const r=(0,u.getQueryArg)(e,"d");if(!r||!r.includes("ui-avatars.com"))return e;const s=r.match(/\/api\/(.*?)\/64\//),i=s&&s.length>1?s[1]:r,a=E(t||i),o=r.indexOf("/64/");return-1!==o&&(e=(0,u.addQueryArgs)(e,{d:`${r.substring(0,o+4)}/${a.backgroundColor.replace("#","")}/${a.color.replace("#","")}`})),e.includes("%2F64%2F%")&&(e=e.replace("%2F64%2F%","%2F360%2F%")),e};function D(e){return"string"==typeof e&&!!(new DOMParser).parseFromString(e,"text/html").querySelector("a[data-navigate-collection]")}const F=({record:e,value:t,rawValue:n,name:r,viewType:s,path:i,handleClick:o,isHtml:l})=>{const d="table"!==s?"":A(e.avatar_url,n);let u=t;if(l){if(D(t)){const e=t.replace(/data-navigate-collection/g,'href="#" data-navigate-collection');return(0,g.jsx)("div",{dangerouslySetInnerHTML:{__html:e},onClick:o})}u=(0,g.jsx)("div",{dangerouslySetInnerHTML:{__html:t}})}const p=(0,c.useMemo)(()=>i?{className:"hizzlewp-records-title-field hizzlewp-records-title-field--clickable",role:"button",tabIndex:0,onClick:e=>{e.stopPropagation(),(0,m.updatePath)(i)},onKeyDown:e=>{"Enter"!==e.key&&""!==e.key&&" "!==e.key||(e.stopPropagation(),(0,m.updatePath)(i))}}:{className:"hizzlewp-records-title-field"},[i]);return(0,g.jsxs)(a.__experimentalHStack,{spacing:3,justify:"flex-start",children:[d&&(0,g.jsx)("div",{className:"hizzlewp-records-view-table-column-primary__media",children:(0,g.jsx)("img",{className:"hizzlewp-avatar",src:d,alt:n})}),(0,g.jsx)("div",{...p,children:u})]})},N=({value:e,enums:t={}})=>{const[n,r]=(0,c.useState)(!1),s=n?e:e.slice(0,2),i=e.length>2;return(0,g.jsxs)(a.Flex,{gap:2,justify:"flex-start",wrap:!0,children:[s.map(e=>(0,g.jsx)(a.FlexItem,{children:(0,g.jsx)(R,{style:E(e),children:t[e]||e})},e)),i&&(0,g.jsx)(a.FlexItem,{children:(0,g.jsx)(a.Button,{variant:"link",onClick:()=>r(!n),children:n?(0,C.__)("Hide","newsletter-optin-box"):(0,C.__)("Show all","newsletter-optin-box")})})]})},T=({row:e,header:t,viewType:n="table",isBadge:r=!1,namespace:s,collection:i})=>{const o=e[t.name]&&void 0!==e[t.name].rendered?e[t.name].rendered:e[t.name],l=(0,w.getRawValue)(e[t.name]),d=`${s}/${i}`,u=t.js_props?.isHtml||e[t.name]?.rendered,p=(0,c.useCallback)(e=>{const t=e?.target?.closest?.("a[data-navigate-collection]");if(t){e.preventDefault(),e.stopPropagation();const n=t.getAttribute("data-navigate-collection");n.startsWith("/")?(0,m.updateQueryString)({},n,{}):(0,m.updatePath)(`${d}/${n}`)}},[d]);if(null==l||""===l||Array.isArray(o)&&0===o.length)return(0,g.jsx)("span",{className:"hizzlewp-view-table__cell--null",children:"–"});if(t.is_primary&&"string"==typeof o)return(0,g.jsx)(F,{record:e,name:t.name,viewType:n,path:`${d}/${(0,w.getRawValue)(e.id)}`,rawValue:l,value:o,header:t,handleClick:p,isHtml:u});if("avatar_url"===t.name){const t=A(e.avatar_url,o,"table"!==n);return t?"table"!==n?(0,g.jsx)("img",{src:t,alt:o}):t?(0,g.jsx)("img",{className:"hizzlewp-avatar",src:t,alt:o}):null:null}if(t.is_boolean){const e=o?"yes":"no",t=o?"#3a9001":"#880000";return(0,g.jsx)(a.Icon,{size:24,style:{color:t},icon:e})}if(t.is_date&&o){const e=(0,z.getSettings)();return 10===o.length?(0,z.dateI18n)(e.formats.date,o):(0,z.dateI18n)(e.formats.datetime,o)}if(t.is_tokens&&Array.isArray(o))return(0,g.jsx)(N,{value:o});if(t.enum&&Array.isArray(o))return(0,g.jsx)(N,{value:o,enums:t.enum});if(t.is_numeric||t.is_float||"string"==typeof o){if(t.enum&&(h=t.enum)&&"object"==typeof h&&h.constructor===Object)return(0,g.jsx)(R,{style:E(o),children:t.enum?.[o]||o});if(u){if(D(o)){const e=o.replace(/data-navigate-collection/g,'href="#" data-navigate-collection');return(0,g.jsx)("div",{dangerouslySetInnerHTML:{__html:e},onClick:p})}return(0,g.jsx)("div",{dangerouslySetInnerHTML:{__html:o}})}return o}var h;return JSON.stringify(o)};var B=n(809),O=n.n(B),I=n(213);const P=({fields:e,back:t,query:n})=>{const{config:{namespace:r,collection:s,props:i}}=(0,w.useProvidedCollectionConfig)(),o={...n,__fields:e.join(","),per_page:-1,context:"edit"},l=(0,w.useCollectionRecords)(r,s,o),d=(0,c.useMemo)(()=>{if(!l.records?.length)return[];const e=i.reduce((e,t)=>(e[t.name]=t.js_props?.table_label||t.label,e),{});return Object.keys(l.records[0]).map(t=>e[t]||t)},[i,l.records]),u=(0,c.useMemo)(()=>l.records?.length&&d.length?O().unparse({fields:d,data:l.records.map(e=>Object.values(e))},{escapeFormulae:!0}):"",[l.records,d]),p=(0,g.jsx)(a.Button,{variant:"link",onClick:t,children:(0,C.__)("Go Back","newsletter-optin-box")});if(l.isResolving)return(0,g.jsxs)(a.__experimentalText,{size:16,as:"p",children:[(0,g.jsx)(a.Spinner,{style:{marginLeft:0}}),(0,C.__)("Preparing records...","newsletter-optin-box")]});if("ERROR"===l.status||l.error)return(0,g.jsxs)(a.Notice,{status:"error",isDismissible:!1,children:[l.error?.message||"An unknown error occurred.","   ",p]});if(!l.records?.length)return(0,g.jsxs)(a.Notice,{status:"info",isDismissible:!1,children:["Found no records to export.   ",p]});const h=`${r}-${s}-${Date.now()}.csv`;return(0,g.jsxs)(a.Notice,{status:"success",isDismissible:!1,children:[(0,C.__)("Done! Click the button below to download records.","newsletter-optin-box"),"   ",(0,g.jsx)(a.Button,{variant:"primary",text:(0,C.__)("Download CSV","newsletter-optin-box"),onClick:()=>(0,I.saveAs)(new Blob([u],{type:"text/csv;charset=utf-8"}),h)})]})},M=({fields:e,setFields:t,next:n})=>{const{config:{ignore:r,props:s}}=(0,w.useProvidedCollectionConfig)(),i=(0,c.useMemo)(()=>s.filter(e=>!r.includes(e.name)),[s,r]);return(0,g.jsxs)(a.Flex,{direction:"column",gap:4,children:[(0,g.jsx)(a.FlexItem,{children:(0,g.jsx)("p",{className:"description",children:(0,C.__)("Select the fields to include in your exported file","newsletter-optin-box")})}),i.map(n=>(0,g.jsx)(a.FlexItem,{children:(0,g.jsx)(a.ToggleControl,{label:n.label===n.description?n.label:`${n.label} (${n.description})`,checked:e.includes(n.name),onChange:()=>{e.includes(n.name)?t(e.filter(e=>e!==n.name)):t([...e,n.name])},__nextHasNoMarginBottom:!0})},n.name)),(0,g.jsx)(a.FlexItem,{children:(0,g.jsxs)(a.Button,{className:"hizzlewp-block-button",variant:"primary",onClick:n,children:[(0,g.jsx)(a.Icon,{icon:"download"}),(0,C.__)("Download","newsletter-optin-box")]})})]})},$=({query:e})=>{const{config:{hidden:t,ignore:n,props:r}}=(0,w.useProvidedCollectionConfig)(),[s,i]=(0,c.useState)(r.map(e=>t.includes(e.name)||n.includes(e.name)?null:e.name).filter(Boolean)),[a,o]=(0,c.useState)("fields");return"fields"===a?(0,g.jsx)(M,{fields:s,setFields:i,next:()=>o("progress")}):(0,g.jsx)(P,{fields:s,query:e,back:()=>o("fields")})},L=({query:e,isAllSelected:t,recordsCount:n})=>{const[r,s]=(0,c.useState)(!1),i=t?(0,C.__)("Download","newsletter-optin-box"):(0,C.__)("Download Selected","newsletter-optin-box"),o=t?(0,C.sprintf)(/* translators: %s: number of records */ /* translators: %s: number of records */
(0,C.__)("Download all %s records","newsletter-optin-box"),n):(0,C.sprintf)(/* translators: %s: number of records */ /* translators: %s: number of records */
(0,C.__)("Download %s selected records","newsletter-optin-box"),n);return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(a.Button,{onClick:()=>s(!0),variant:"tertiary",text:i,label:t?(0,C.__)("Download all matching records","newsletter-optin-box"):(0,C.__)("Download Selected","newsletter-optin-box"),showTooltip:!0}),r&&(0,g.jsx)(a.Modal,{title:o,onRequestClose:()=>s(!1),children:(0,g.jsx)("div",{className:"hizzle-records-export-modal__body",children:(0,g.jsx)(h.ErrorBoundary,{children:(0,g.jsx)($,{query:e})})})})]})},H=({query:e,isAllSelected:t,recordsCount:n})=>{const{namespace:r,collection:s}=(0,w.useProvidedCollection)()||{},[i,o]=(0,c.useState)(!1),[d,u]=(0,c.useState)(null),[p,h]=(0,c.useState)(!1),m=t?(0,C.__)("Delete","newsletter-optin-box"):(0,C.__)("Delete Selected","newsletter-optin-box"),{bulkDeleteCollectionRecords:f}=(0,l.useDispatch)(w.store),x=(0,c.useCallback)(t=>{t?.preventDefault(),p||(h(!0),f(r,s,e).then(e=>{o(!1)}).catch(e=>{u(e)}).finally(()=>{h(!1)}))},[p,r,s,e]),_=d?.message||(t?(0,C.sprintf)(
// translators: %d: Number of records being deleted.
// translators: %d: Number of records being deleted.
(0,C.__)("Are you sure you want to delete %d matching records?","newsletter-optin-box"),n):(0,C.sprintf)(
// translators: %d: Number of records being deleted.
// translators: %d: Number of records being deleted.
(0,C.__)("Are you sure you want to delete %d selected records?","newsletter-optin-box"),n));return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(a.Button,{onClick:()=>o(!0),variant:"tertiary",text:m,label:t?(0,C.__)("Delete all matching records","newsletter-optin-box"):(0,C.__)("Delete Selected","newsletter-optin-box"),showTooltip:!0,isDestructive:!0}),i&&(0,g.jsx)(a.Modal,{title:m,onRequestClose:()=>o(!1),children:(0,g.jsx)(a.__experimentalVStack,{children:p?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(a.Spinner,{}),(0,C.__)("Deleting...","newsletter-optin-box")]}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(a.__experimentalText,{isDestructive:!0,children:_}),(0,g.jsxs)(a.__experimentalHStack,{wrap:!0,children:[(0,g.jsx)(a.Button,{className:"hizzlewp-block-button",isDestructive:!0,variant:"primary",onClick:x,children:(0,C.__)("Yes, Delete!","newsletter-optin-box")}),(0,g.jsx)(a.Button,{className:"hizzlewp-block-button",onClick:()=>o(!1),variant:"secondary",children:(0,C.__)("Cancel","newsletter-optin-box")})]})]})})})]})},U=()=>{const{config:{namespace:e,collection:t,defaultFilters:n}}=(0,w.useProvidedCollectionConfig)(),r=((e,t)=>{const{preferences:n,setPreferences:r}=(0,p.usePreferences)("savedFilters",`${e}/${t}`),s=n||{};return{savedFilters:{...Object.entries(s).reduce((e,[t,n])=>({...e,[W(t)]:n.trim()}),{})},saveFilter:(e,t)=>{r({...s,[W(t)]:e.trim()})},deleteFilter:e=>{r(Object.fromEntries(Object.entries(s).filter(([t])=>t!==W(e))))}}})(e,t),s={...Object.entries(n||{}).reduce((e,[t,n])=>({...e,[W(t)]:n.trim()}),{})},i=(0,c.useMemo)(()=>({...r.savedFilters,...s}),[r,s]);return{...r,defaultFilters:s,allFilters:i,getQueryName:e=>i[W((0,u.addQueryArgs)("",e))],hasNamedFilter:e=>Boolean(r.savedFilters[e.trim()])}},V=({onClose:e,allFilters:t,onSave:n})=>{const[r,s]=(0,c.useState)(""),[i,o]=(0,c.useState)(""),l=()=>{r?.trim()?Object.values(t).find(e=>e===r.trim())&&!window.confirm((0,C.sprintf)(
// translators: %s: filter name
// translators: %s: filter name
(0,C.__)('A filter named "%s" already exists. Do you want to overwrite it?',"hizzlewp"),r.trim()))||(n(r.trim()),d()):o((0,C.__)("Please enter a filter name.","hizzlewp"))},d=()=>{s(""),o(""),e()};return(0,g.jsx)(a.Modal,{title:(0,C.__)("Add to saved filters","hizzlewp"),onRequestClose:d,children:(0,g.jsxs)(a.__experimentalVStack,{children:[i&&(0,g.jsx)(a.Notice,{status:"error",isDismissible:!1,children:i}),(0,g.jsx)(a.__experimentalInputControl,{label:(0,C.__)("Filter Name","hizzlewp"),value:r,onChange:s,placeholder:(0,C.__)("Enter a name for this filter set","hizzlewp"),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),l())},__next40pxDefaultSize:!0}),(0,g.jsxs)(a.__experimentalHStack,{justify:"flex-end",spacing:2,children:[(0,g.jsx)(a.Button,{variant:"tertiary",onClick:d,children:(0,C.__)("Cancel","hizzlewp")}),(0,g.jsx)(a.Button,{variant:"primary",onClick:l,children:(0,C.__)("Save Filter","hizzlewp")})]})]})})},q=({query:e})=>{const t=W((0,u.addQueryArgs)("",e)),{saveFilter:n,deleteFilter:r,allFilters:s,defaultFilters:i}=U(),o=!!s[t],l=!!i[t],[d,p]=(0,c.useState)(!1);return(0,g.jsxs)(g.Fragment,{children:[o&&!l&&(0,g.jsx)(a.Button,{size:"compact",variant:"tertiary",onClick:()=>r(t),icon:"star-filled",label:(0,C.__)("Remove from saved filters","hizzlewp"),isDestructive:!0,showTooltip:!0}),!o&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(a.Button,{size:"compact",onClick:()=>p(!0),icon:"star-empty",label:(0,C.__)("Add to saved filters","hizzlewp"),showTooltip:!0}),d&&(0,g.jsx)(V,{onClose:()=>p(!1),allFilters:s,onSave:e=>n(e,t)})]})]})},Q=()=>{const{allFilters:e}=U(),t=(0,u.addQueryArgs)("",(0,m.useQuery)()),n=[{label:(0,C.__)("Select a view...","hizzlewp"),value:""},...Object.entries(e).map(([e,t])=>({label:t,value:e}))],r=(0,c.useCallback)(e=>{e&&(0,m.updateQueryString)({...(0,u.getQueryArgs)(W(e)),paged:"1"})},[m.updateQueryString]);return 0===Object.keys(e).length?null:(0,g.jsx)(a.SelectControl,{label:(0,C.__)("Select a view...","hizzlewp"),value:W(t),options:n,onChange:r,style:{maxWidth:200},__nextHasNoMarginBottom:!0,hideLabelFromVision:!0})},W=e=>{if(!e)return"";const{paged:t,per_page:n,page:r,...s}=(0,u.getQueryArgs)(e);if(0===Object.keys(s).length)return"";const i=Object.keys(s).sort().reduce((e,t)=>(e[t]=s[t],e),{});return(0,u.addQueryArgs)("",i)},K=e=>{const t={};return e.forEach(e=>{e.value.forEach(n=>{t[e.id+n.suffix]=n.value})}),t},G=({fields:e,onApplyFilters:t,filters:n,setAttributes:r})=>(0,g.jsx)("form",{onSubmit:t,children:e.map(e=>{const t={name:e.name,...Y(e),default:"",placeholder:(0,C.__)("Any","newsletter-optin-box"),canSelectPlaceholder:!0};let s=null;return e.is_boolean?(t.el="select",t.options={1:(0,C.__)("Yes","newsletter-optin-box"),0:(0,C.__)("No","newsletter-optin-box")}):e.is_numeric||e.is_float?(t.name=`${e.name}_min`,t.label=(0,C.sprintf)(
// translators: %s: Field label.
// translators: %s: Field label.
(0,C._x)("%s - Min","Number","newsletter-optin-box"),e.label),s={...t,name:`${e.name}_max`,label:(0,C.sprintf)(
// translators: %s: Field label.
// translators: %s: Field label.
(0,C._x)("%s - Max","Number","newsletter-optin-box"),e.label)}):e.is_date?(t.name=`${e.name}_after`,t.label=(0,C.sprintf)(
// translators: %s: Date field label.
// translators: %s: Date field label.
(0,C._x)("%s - After","Date","newsletter-optin-box"),e.label),s={...t,name:`${e.name}_before`,label:(0,C.sprintf)(
// translators: %s: Date field label.
// translators: %s: Date field label.
(0,C._x)("%s - Before","Date","newsletter-optin-box"),e.label)}):e.is_primary?(t.el="textarea",t.description=(0,C.__)("Separate multiple values with a comma.","newsletter-optin-box")):s={...t,name:`${e.name}_not`,label:(0,C.sprintf)(
// translators: %s: Field label.
// translators: %s: Field label.
(0,C.__)("%s - Exclude","newsletter-optin-box"),e.label)},(0,g.jsxs)(c.Fragment,{children:[(0,g.jsx)("div",{style:{marginBottom:"1.6rem"},children:(0,g.jsx)(h.Setting,{settingKey:t.name,saved:n,setAttributes:r,setting:t})}),s&&(0,g.jsx)("div",{style:{marginBottom:"1.6rem"},children:(0,g.jsx)(h.Setting,{settingKey:s.name,saved:n,setAttributes:r,setting:s})})]},e.name)})}),Z=({currentFilters:e,fields:t,setOpen:n})=>{const[r,s]=(0,c.useState)({...e}),i=e=>{e?.preventDefault(),r&&0===Object.keys(r).length?(0,m.updateQueryString)({hizzlewp_filters:"",paged:"1"}):(0,m.updateQueryString)({hizzlewp_filters:JSON.stringify(r),paged:"1"}),n(!1)};return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(G,{fields:t,filters:r,onApplyFilters:i,setAttributes:e=>{s({...r,...e})}}),(0,g.jsx)(a.Button,{className:"hizzlewp-block-button",variant:"primary",onClick:i,text:(0,C.__)("Apply Filters","newsletter-optin-box")})]})},J=({isBulkEditing:e=!1})=>{const{config:t}=(0,w.useProvidedCollectionConfig)();return(0,c.useMemo)(()=>t.schema?t.schema.filter(n=>!(n.readonly&&e||n.is_dynamic||Array.isArray(t.ignore)&&t.ignore.includes(n.name)||Array.isArray(t.hidden)&&t.hidden.includes(n.name)||!n.is_tokens&&(e||!(n.is_numeric||n.is_float||n.is_date||n.is_primary))&&(!n.enum||Array.isArray(n.enum)))):[],[t,e])},Y=e=>{const t={default:e.default,label:e.label,el:"input",type:"text",name:e.name,isInputToChange:!0};return e.js_props?.setting&&(t.customAttributes=e.js_props.setting),e.js_props?.conditions&&(t.conditions=e.js_props?.conditions),e.is_tokens?(t.el="form_token",t.suggestions=e.suggestions):e.enum&&!Array.isArray(e.enum)?(t.el="select",t.options=e.enum,e.multiple&&(t.multiple=!0)):e.is_textarea&&(t.el="textarea"),(e.is_numeric||e.is_float)&&(t.type="number"),e.is_date&&(t.type="datetime-local",t.placeholder="YYYY-MM-DDTHH:MM:SS+ZZ:ZZ"),e.is_boolean&&(t.type="toggle"),e.description&&e.description!==e.label&&(t.description=e.description),t},X=()=>{const e=(0,m.useQuery)(),t=J({isBulkEditing:!1});return(0,c.useMemo)(()=>{const n=[],r=e?.hizzlewp_filters;if(!r||"string"!=typeof r)return{fields:t,filters:[],preparedFilters:{}};try{const e=JSON.parse(r);if(!e||"object"!=typeof e)return{fields:t,filters:[],preparedFilters:{}};const s=(e=>{const t={};return Object.entries(e).forEach(([e,n])=>{if(!n)return;const r=e.match(/(.*?)(_not|_min|_max|_before|_after)$/),s=r?r[1]:e,i=r?r[2]:"";t[s]||(t[s]={id:s,value:[]}),t[s].value.push({suffix:i,value:n})}),Object.values(t)})(e);if(!Array.isArray(s))return{fields:t,filters:[],preparedFilters:{}};n.push(...s)}catch(e){return{fields:t,filters:[],preparedFilters:{}}}const s=n.filter(e=>e.id&&t.some(t=>t.name===e.id)&&Array.isArray(e.value)&&e.value.length>0),i=K(s);return{fields:t,filters:s,preparedFilters:i}},[e,t])},ee=()=>{const[e,t]=(0,c.useState)(!1),{fields:n,preparedFilters:r}=X(),s=Object.keys(r).length,i=s>0?(0,C.sprintf)(
// translators: %d: number of filters applied.
// translators: %d: number of filters applied.
(0,C.__)("Applied Filters (%d)","newsletter-optin-box"),s):(0,C.__)("Filter Records","newsletter-optin-box");return(0,g.jsxs)(a.__experimentalHStack,{expanded:!1,children:[(0,g.jsx)(Q,{}),n.length>0&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(a.Button,{onClick:()=>t(!0),variant:s>0?"tertiary":void 0,icon:"filter",text:i}),e&&(0,g.jsx)(a.Modal,{title:(0,C.__)("Filter records","newsletter-optin-box"),onRequestClose:()=>t(!1),children:(0,g.jsx)(Z,{fields:n,currentFilters:r,setOpen:t})})]})]})},te=({editableFields:e,onSave:t,changes:n,setAttributes:r})=>(0,g.jsx)("form",{onSubmit:t,children:e.map(e=>{const t={name:e.name,...Y(e),default:"",placeholder:(0,C.__)("Do not update","newsletter-optin-box")};let s=null;return e.multiple&&(t.label=(0,C.sprintf)(
// translators: %s: Field label, e.g. "Tags".
// translators: %s: Field label, e.g. "Tags".
(0,C.__)("%s - To Add","newsletter-optin-box"),e.label),t.name=`${e.name}::add`,s={...t,name:`${e.name}::remove`,label:(0,C.sprintf)(
// translators: %s: Field label, e.g. "Tags".
// translators: %s: Field label, e.g. "Tags".
(0,C.__)("%s - To Remove","newsletter-optin-box"),e.label)}),(0,g.jsxs)(i.Fragment,{children:[(0,g.jsx)("div",{style:{marginBottom:"1.6rem"},children:(0,g.jsx)(h.Setting,{settingKey:t.name,saved:n,setAttributes:r,setting:t})}),s&&(0,g.jsx)("div",{style:{marginBottom:"1.6rem"},children:(0,g.jsx)(h.Setting,{settingKey:s.name,saved:n,setAttributes:r,setting:s})})]},e.name)})}),ne=({isBulkEditing:e=!0,query:t,isAllSelected:n,recordsCount:r})=>{const{namespace:s,collection:o}=(0,w.useProvidedCollection)()||{},[c,d]=(0,i.useState)(!1),u=n?(0,C.__)("Bulk Edit","newsletter-optin-box"):(0,C.__)("Edit Selected","newsletter-optin-box"),[p,h]=(0,i.useState)(null),[m,f]=(0,i.useState)(!1),[x,_]=(0,i.useState)(!1),[b,y]=(0,i.useState)({}),j=Object.keys(b).length>0,{bulkUpdateCollectionRecords:v}=(0,l.useDispatch)(w.store),k=e=>{e?.preventDefault(),m||(f(!0),v(s||"",o||"",t,b).then(()=>{_(!0),y({})}).catch(e=>{h(e)}).finally(()=>{f(!1)}))},S=J({isBulkEditing:e});return 0===S.length?null:(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(a.Button,{onClick:()=>d(!0),variant:"tertiary",text:u,label:n?(0,C.__)("Edit all matching records","newsletter-optin-box"):(0,C.__)("Edit Selected","newsletter-optin-box"),showTooltip:!0}),c&&(0,g.jsxs)(a.Modal,{title:u,onRequestClose:()=>d(!1),children:[(0,g.jsx)(te,{editableFields:S,changes:b,onSave:k,setAttributes:e=>{y({...b,...e}),p&&h(null),x&&_(!1)}}),j&&(0,g.jsxs)(a.Button,{className:"hizzlewp-block-button",variant:"primary",onClick:k,isBusy:m,children:[!m&&(0,g.jsx)(a.Icon,{icon:"cloud-saved"})," ",(0,C.sprintf)(m?
// translators: %d: Number of records being saved.
// translators: %d: Number of records being saved.
(0,C.__)("Updating %d records...","newsletter-optin-box"):
// translators: %d: Number of records being edited.
// translators: %d: Number of records being edited.
(0,C.__)("Update %d records","newsletter-optin-box"),r),m&&(0,g.jsx)(a.Spinner,{})]}),p&&!j&&(0,g.jsx)(a.Notice,{status:"error",isDismissible:!0,children:p.message}),x&&!j&&(0,g.jsx)(a.Notice,{status:"success",isDismissible:!0,children:(0,C.__)("Records updated successfully.","newsletter-optin-box")})]})]})},re=({children:e})=>(0,g.jsx)(a.FlexItem,{children:(0,g.jsx)(h.ErrorBoundary,{children:e})}),se=({query:e})=>{const t=(e=>{const{namespace:t,collection:n}=(0,w.useProvidedCollection)()||{},r=(0,l.useSelect)(r=>({selected:r(w.store).getSelectedCollectionRecords(t,n,e),isAllSelected:r(w.store).getIsAllCollectionRecordsSelected(t,n,e),matchingRecordsCount:r(w.store).getCollectionRecordsTotalItems(t,n,e)}),[t,n,e]),s=Object.values(r.selected).filter(Boolean),i=r.isAllSelected||!s.length,a=["order","orderby","paged","per_page"],o=Object.fromEntries(Object.entries(e).filter(([e])=>!a.includes(e)));return{isAllSelected:i,query:i?o:{include:Object.keys(r.selected).filter(e=>r.selected[e])},recordsCount:i?r.matchingRecordsCount:s.length}})(e);return(0,g.jsxs)(a.__experimentalHStack,{children:[(0,g.jsx)(re,{children:(0,g.jsx)(ne,{...t,isBulkEditing:!0})}),(0,g.jsx)(re,{children:(0,g.jsx)(L,{...t})}),(0,g.jsx)(re,{children:(0,g.jsx)(H,{...t})})]})},ie=(0,g.jsx)(b.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,g.jsx)(b.Path,{d:"M13 19h-2v-2h2v2zm0-6h-2v-2h2v2zm0-6h-2V5h2v2z"})}),ae=window.wp.compose,oe=({value:e,onClick:t=()=>{},as:n=a.Button,...r})=>{const{createInfoNotice:s}=(0,l.useDispatch)(f.store),i=(0,ae.useCopyToClipboard)(e,()=>{s("Copied to clipboard.",{type:"snackbar"}),t?.()}),o=n||a.Button;return(0,g.jsx)(o,{label:"Click to copy",ref:i,showTooltip:!0,...r})},le=(0,g.jsx)(b.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,g.jsx)(b.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M12 5.5A2.25 2.25 0 0 0 9.878 7h4.244A2.251 2.251 0 0 0 12 5.5ZM12 4a3.751 3.751 0 0 0-3.675 3H5v1.5h1.27l.818 8.997a2.75 2.75 0 0 0 2.739 2.501h4.347a2.75 2.75 0 0 0 2.738-2.5L17.73 8.5H19V7h-3.325A3.751 3.751 0 0 0 12 4Zm4.224 4.5H7.776l.806 8.861a1.25 1.25 0 0 0 1.245 1.137h4.347a1.25 1.25 0 0 0 1.245-1.137l.805-8.861Z"})}),ce=({confirm:e,closeModal:t,namespace:n,collection:r,id:s})=>{const{deleteCollectionRecord:i}=(0,l.useDispatch)(w.store),{createSuccessNotice:o,createErrorNotice:d}=(0,l.useDispatch)(f.store),{isDeleting:u,deletingError:p}=(0,l.useSelect)(e=>({isDeleting:e(w.store).isDeletingCollectionRecord(n,r,s),deletingError:e(w.store).getLastCollectionDeleteError(n,r,s)}),[n,r,s]),h=(0,c.useCallback)(e=>{e?.preventDefault(),u||i(n,r,s).then(()=>{o((0,C.__)("Record deleted successfully.","newsletter-optin-box"),{type:"snackbar"}),(0,m.updatePath)(`/${n}/${r}`)}).catch(e=>{d(e.message,{isDismissible:!0,type:"default"});const t=document.getElementById("hizzlewp-collection__main-content");t&&t.parentElement?.scrollTo({top:0,behavior:"smooth"})})},[i,o,d,n,r,s]);return(0,g.jsxs)(a.__experimentalVStack,{spacing:8,children:[(0,g.jsx)(a.__experimentalText,{variant:"muted",children:e||(0,C.__)("Are you sure you want to delete this item?","newsletter-optin-box")}),(0,g.jsxs)(a.__experimentalHStack,{justify:"flex-start",children:[(0,g.jsx)(a.Button,{variant:"primary",isDestructive:!0,onClick:h,isBusy:u,__next40pxDefaultSize:!0,children:u?(0,C.__)("Deleting...","newsletter-optin-box"):(0,C.__)("Delete","newsletter-optin-box")}),(0,g.jsx)(a.Button,{variant:"secondary",onClick:t,__next40pxDefaultSize:!0,children:(0,C.__)("Cancel","newsletter-optin-box")})]}),p&&(0,g.jsx)(a.Notice,{status:"error",isDismissible:!1,children:p?.message})]})},de=({label:e,...t})=>{const[n,r]=(0,c.useState)(!1);return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(a.Button,{isDestructive:!0,onClick:()=>r(!0),icon:le,variant:"secondary",children:e}),n&&(0,g.jsx)(a.Modal,{title:e,onRequestClose:()=>{r(!1)},children:(0,g.jsx)(ce,{...t,closeModal:()=>r(!1)})})]})},ue=({as:e=a.Button,onClick:t=()=>{},...n})=>{const[r,s]=(0,c.useState)(!1),i=e||a.Button,o=()=>{s(!1),t?.()};return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(i,{isDestructive:!0,onClick:()=>s(!0),icon:le,...n}),r&&(0,g.jsx)(a.Modal,{title:n.label||n.text,onRequestClose:o,children:(0,g.jsx)(ce,{...n,closeModal:o})})]})},pe=({children:e=null,actionName:t,as:n=a.Button,namespace:r,collection:s,id:i,onClick:o,...d})=>{const{doRemoteCollectionRecordAction:u}=(0,l.useDispatch)(w.store),{createSuccessNotice:p,createErrorNotice:h}=(0,l.useDispatch)(f.store),m=(0,l.useSelect)(e=>e(w.store).isDoingRemoteCollectionRecordAction(r,s,i,t),[r,s,t,i]),x=(0,c.useCallback)(e=>{e?.preventDefault(),m||u(r,s,i,t).then(e=>{p(e?.message,{type:"snackbar"}),o?.()}).catch(e=>{h(e.message,{isDismissible:!0,type:"default"});const t=document.getElementById("hizzlewp-collection__main-content");t&&t.parentElement?.scrollTo({top:0,behavior:"smooth"})})},[u,p,h,r,s,t,i]),_=n||a.Button;return(0,g.jsxs)(_,{onClick:x,...d,children:[e,m&&(0,g.jsx)(a.Spinner,{})]})},he=[],me=({actions:e,isOverview:t=!1,...n})=>{const{primaryActions:r,preparedActions:s}=(0,c.useMemo)(()=>{const n=[...e||he];return t||n.find(e=>"edit"===e.id)||n.unshift({id:"edit",type:"edit",text:(0,C.__)("Edit"),icon:"edit",isPrimary:!0}),n.find(e=>"delete"===e.id)||n.push({id:"delete",type:"delete",text:(0,C.__)("Delete"),isPrimary:t,icon:"trash"}),{primaryActions:n.filter(e=>e.isPrimary&&!!e.icon),preparedActions:n}},[e]);return(0,g.jsxs)(a.__experimentalHStack,{spacing:1,justify:"flex-end",className:"hizzlewp-records-item-actions",style:{flexShrink:"0",width:"auto"},onClick:e=>{e.stopPropagation()},expanded:!1,children:[r.map(e=>(0,g.jsx)(ge,{as:a.Button,action:e,onClose:()=>{},...n},e.id)),(0,g.jsx)(fe,{actions:s,...n,isOverview:t})]})},fe=({actions:e,isOverview:t,...n})=>{let r={className:"hizzlewp-records-all-actions-button",size:"compact"};return t&&(r={iconSize:32,variant:"tertiary"}),(0,g.jsx)(a.DropdownMenu,{label:(0,C.__)("Actions"),icon:ie,toggleProps:{...r,disabled:!e.length},popoverProps:{placement:"bottom-end"},children:({onClose:t})=>(0,g.jsx)(g.Fragment,{children:e.map(e=>(0,g.jsx)(ge,{action:e,onClose:t,...n},e.id))})})},ge=({action:e,onClose:t,as:n,...r})=>{const{isPrimary:s,type:i,...a}=e;if("copy"===i)return(0,g.jsx)(xe,{as:n,Component:oe,props:r,...a,onClick:t});if("delete"===i)return(0,g.jsx)(xe,{as:n,Component:ue,props:r,...a,...r,onClick:t});if("remote"===i)return(0,g.jsx)(xe,{as:n,Component:pe,props:r,...a,...r,onClick:t});const o={...a};return"edit"===i&&(o.onClick=()=>{(0,m.updatePath)(`/${r.namespace}/${r.collection}/${r.id}`),t?.()}),(0,g.jsx)(xe,{as:n,props:r,...o})},xe=({props:e,Component:t,as:n,text:r,...s})=>{const i=n||a.MenuItem,o={label:r,...s},l=t||i;return t&&(o.as=i),n?(0,g.jsx)(l,{showTooltip:!0,...o}):(0,g.jsx)(l,{...o,children:r})},_e=(e,t)=>{const{preferences:n}=(0,p.usePreferences)("recordsTablePreferences",`${e}/${t}`),r=(0,m.useQuery)(),{preparedFilters:s}=X();return(0,c.useMemo)(()=>{const e={...r,...s};return!r.orderby&&n?.sorting?.[0]?.id&&(e.orderby=n.sorting[0].id,e.order=n.sorting[0].desc?"desc":"asc"),!r.per_page&&n?.pagination?.pageSize&&(e.per_page=n.pagination.pageSize),e.per_page&&!S.PER_PAGE_OPTIONS.includes(Number(e.per_page))&&(e.per_page=-1),delete e.page,delete e.hizzlewp_filters,e},[r,s,n])},be=()=>{const{config:{namespace:e,collection:t,props:n,ignore:r,hidden:s,badges:i,labels:o}}=(0,w.useProvidedCollectionConfig)()||{},{preferences:d,setPreferences:u}=(0,p.usePreferences)("recordsTablePreferences",`${e}/${t}`),{preferences:f}=(0,p.usePreferences)("view",`${e}/${t}`),x=(0,m.useQuery)(),_=_e(e,t),b=(0,w.useCollectionRecords)(e,t,_),{columns:y,primaryColumn:j}=(0,c.useMemo)(()=>{const s=[];let a="";return n.forEach(n=>{n.is_textarea&&!n.is_tokens&&(!n.enum||Array.isArray(n.enum))||r.includes(n.name)||"hide"===n.js_props?.table||(n.is_primary&&(a=n.name),s.push({accessorKey:n.name,header:n.js_props?.table_label||n.label,enableSorting:!n.is_dynamic&&!n.is_meta,enableColumnFilter:!n.is_dynamic,enableHiding:!n.is_primary,cell:({row:r})=>(0,g.jsx)(T,{row:r.original,header:n,isBadge:Array.isArray(i)&&i.includes(n.name),namespace:e,collection:t}),meta:{is_primary:n.is_primary,options:n.enum,multiple:n.multiple,is_dynamic:n.is_dynamic,is_boolean:n.is_boolean,is_numeric:n.is_numeric||n.is_float,is_date:n.is_date,is_tokens:n.is_tokens,suggestions:n.suggestions}}))}),s.push({id:"hizzlewp-actions",header:"Actions",enableSorting:!1,enableColumnFilter:!1,enableHiding:!1,enablePinning:!1,cell:({row:n})=>(0,g.jsx)(me,{actions:n.original.hizzlewp_actions,namespace:e,collection:t,id:(0,w.getRawValue)(n.original.id)})}),{columns:s,primaryColumn:a}},[n,r]),v=(0,c.useMemo)(()=>(Array.isArray(f?.hiddenFields)?f?.hiddenFields:s).reduce((e,t)=>(e[t]=!1,e),{}),[s,f]),{filters:k}=X(),z=(0,c.useMemo)(()=>{const e=x.orderby,t=x.order||"desc",n=_.per_page&&-1===Number(_.per_page);return{columnVisibility:v,columnPinning:{left:["hizzlewp-selection",j].filter(Boolean),right:["hizzlewp-actions"]},...d,sorting:e?[{id:e,desc:"desc"===t}]:d?.sorting||[],pagination:{pageSize:n?b.totalItems:x.per_page||d?.pagination?.pageSize||25,pageIndex:n?0:x.paged?Number(x.paged)-1:0},rowSelection:b.selected,globalFilter:x.search||"",columnFilters:k}},[b.selected,b.totalItems,x,d,k]),E=(0,c.useCallback)(e=>{u(e);const t=e?.pagination?.pageSize&&!S.PER_PAGE_OPTIONS.includes(Number(e?.pagination?.pageSize));(0,m.updateQueryString)({orderby:e?.sorting?.[0]?.id||"",order:e?.sorting?.[0]?.desc?"desc":"asc",per_page:t?"-1":`${e?.pagination?.pageSize||25}`,paged:t?"1":`${(e?.pagination?.pageIndex||0)+1}`})},[u]),{setSelectedCollectionRecords:R}=(0,l.useDispatch)(w.store),A=b.isResolving||!b.hasResolved;return A||"ERROR"!==b.status?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(h.ErrorBoundary,{children:(0,g.jsx)(a.Fill,{name:`end/in/filters/${e}/${t}`,children:(0,g.jsx)(q,{query:x})})}),(0,g.jsx)(h.ErrorBoundary,{children:(0,g.jsx)(a.Fill,{name:`in/pagination/${e}/${t}`,children:(0,g.jsx)(a.__experimentalText,{variant:"muted",size:14,children:(0,C.sprintf)(/* translators: 1: Number of records, 2: Singular or plural */ /* translators: 1: Number of records, 2: Singular or plural */
(0,C.__)("Found %1$s %2$s","hizzlewp"),`${b.totalItems||0}`,(1===b.totalItems?o?.singular_name||"record":o?.name||"records").toLowerCase())})})}),(0,g.jsx)(h.ErrorBoundary,{children:(0,g.jsx)(S.Records,{rowCount:b.totalItems||0,data:b.records||[],columns:y,isLoading:A,enableSorting:!0,enablePagination:!0,state:z,onChange:E,enableRowSelection:!0,onRowSelectionChange:n=>R(e,t,_,n(z?.rowSelection||{})),onColumnPinningChange:e=>E({...z,columnPinning:e(z?.columnPinning||{})}),onGlobalFilterChange:e=>{(0,m.updateQueryString)({search:e||"",paged:"1"})},onColumnFiltersChange:e=>{const t=Array.isArray(e)&&e.length>0?JSON.stringify(K(e)):"";(0,m.updateQueryString)({hizzlewp_filters:t,paged:"1"})},getRowId:e=>(0,w.getRawValue)(e.id),searchLabel:o?.search_items||"Search",bulkActions:(0,g.jsx)(se,{query:_}),slotName:`${e}/${t}`,filtersButton:(0,g.jsx)(h.ErrorBoundary,{children:(0,g.jsx)(ee,{})})})})]}):(0,g.jsx)(a.Notice,{status:"error",isDismissible:!1,children:b.error?.message||"An unknown error occurred."})},ye=({namespace:e,collection:t})=>{const n=_e(e,t),{invalidateResolution:r}=(0,l.useDispatch)(w.store);return(0,g.jsx)(a.Button,{icon:y,onClick:()=>r("getCollectionRecords",[e,t,n]),variant:"tertiary",label:"Refresh",showTooltip:!0})},je=()=>{const{config:{namespace:e,collection:t,labels:n,routes:r,fills:s}}=(0,w.useProvidedCollectionConfig)(),{path:i}=(0,m.useRoute)(),o=`/${e}/${t}`,l=(0,c.useMemo)(()=>{const e=[];return o!==i||(e.push({text:n?.add_new_item||"Add New",onClick:()=>(0,m.updatePath)(`${o}/add`),variant:"primary"}),r&&Object.entries(r).forEach(([t,{title:n,...r}])=>{e.push({text:n,onClick:r.href?void 0:()=>(0,m.updatePath)(t),variant:"secondary",...r})})),e},[n,r,i]),d=(0,c.useCallback)(()=>{(0,m.updatePath)(`${e}/${t}`)},[e,t]);return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)(a.__experimentalHStack,{wrap:!0,children:[(0,g.jsx)(h.ErrorBoundary,{children:(0,g.jsx)(a.__experimentalHStack,{expanded:!1,spacing:2,justify:"flex-start",wrap:!0,children:o!==i?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(a.Button,{variant:"primary",onClick:d,icon:j,label:n?.view_items||"View Items",showTooltip:!0,__next40pxDefaultSize:!0}),(0,g.jsx)("span",{children:(0,g.jsx)(a.Slot,{name:`${o}/title`})})]}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(a.__experimentalHeading,{level:1,size:16,truncate:!0,children:n?.name||"Items"}),(0,g.jsx)(ye,{namespace:e,collection:t})]})})}),(0,g.jsx)(h.ErrorBoundary,{children:l.length>0?(0,g.jsx)(a.__experimentalHStack,{as:a.NavigableMenu,orientation:"horizontal",className:"hizzle-store-ui__header-menu",expanded:!1,spacing:0,alignment:"stretch",wrap:!0,children:l.map(e=>(0,g.jsx)(h.ErrorBoundary,{children:(0,g.jsx)(a.Button,{__next40pxDefaultSize:!0,...e})},e.text))}):(0,g.jsx)(a.Slot,{name:`${o}/actions`})})]}),(0,g.jsxs)(a.Card,{isRounded:!1,children:[(0,g.jsx)(h.ErrorBoundary,{children:(0,g.jsx)(m.Outlet,{path:"/:namespace/:collection"})}),s&&s.map(e=>(0,g.jsx)(a.Fill,{name:`${e.name}`,children:(0,g.jsxs)(h.ErrorBoundary,{children:[e.content&&(0,g.jsx)("span",{dangerouslySetInnerHTML:{__html:e.content}}),e.upsell&&(0,g.jsx)(k,{upsell:e.upsell})]})},e.name))]})]})},we=({children:e})=>{const{config:t,isResolving:n,hasResolved:r,error:s}=(0,w.useProvidedCollectionConfig)();return n||!r?(0,g.jsx)(a.Spinner,{}):s||!t?(0,g.jsx)(a.Notice,{status:"error",isDismissible:!1,children:s?.message||"An unknown error occurred."}):(0,g.jsx)(h.ErrorBoundary,{children:e})},ve=({defaultNamespace:e,defaultCollection:t})=>{const{params:n}=(0,m.useRoute)(),r=n?.get("namespace")||e,s=n?.get("collection")||t,i=n?.get("recordId");return(0,g.jsx)(w.CollectionProvider,{namespace:r,collection:s,recordId:i?Number(i):i,children:(0,g.jsx)(h.ErrorBoundary,{children:(0,g.jsx)(we,{children:(0,g.jsx)(je,{})})})})},ke=({children:e,loading:t})=>t?(0,g.jsx)(a.Animate,{type:"loading",children:({className:t})=>(0,g.jsx)("div",{className:t,style:{cursor:"wait"},children:e})}):e,Ce=({record:e,onChange:t,schema:n,hidden:r,ignore:s,onSubmit:i,loading:l,slotName:d,submitText:u,extraSettings:p})=>{const m=(0,c.useMemo)(()=>{let e=Se(n,r,s);return p&&Object.entries(p).forEach(([t,{prop_pos:n,...r}])=>{if(r.name=t,n&&e.find(e=>e.name===n)){const t=e.findIndex(e=>e.name===n);e.splice(t+1,0,r)}else e.push(r)}),e},[n,r,s,p]);return(0,o.useShortcut)("hizzlewp/save-record",e=>{e?.preventDefault(),i()}),(0,g.jsx)(ke,{loading:l,children:(0,g.jsxs)(a.__experimentalVStack,{as:"form",spacing:6,style:{pointerEvents:l?"none":"auto"},onSubmit:i,children:[m.map(n=>(0,g.jsx)(h.ErrorBoundary,{children:(0,g.jsx)(h.Setting,{settingKey:n.name,saved:e,setAttributes:t,setting:n})},n.name)),d&&(0,g.jsx)(a.Slot,{name:d,children:e=>Array.isArray(e)?e.map((e,t)=>(0,g.jsx)(a.Tip,{children:e},t)):e}),(0,g.jsx)(a.Button,{className:"hizzlewp-block-button",variant:"primary",onClick:i,isBusy:l,children:l?(0,g.jsx)(a.Spinner,{}):u})]})})},Se=(e,t,n)=>e.map(e=>e.readonly||e.is_dynamic||"metadata"===e.name||Array.isArray(t)&&t.includes(e.name)||Array.isArray(n)&&n.includes(e.name)?null:Y(e)).filter(e=>!!e),ze=()=>{const{config:{namespace:e,collection:t,props:n,hidden:r,ignore:s,defaultProps:i,labels:a,settings:o}}=(0,w.useProvidedCollectionConfig)()||{},{saveCollectionRecord:d}=(0,l.useDispatch)(w.store),[u,p]=(0,c.useState)(!1),[h,x]=(0,c.useState)({}),_=(0,c.useMemo)(()=>[...s,...Object.keys(i||{})],[s,i]),{createErrorNotice:b,createSuccessNotice:y,removeAllNotices:j}=(0,l.useDispatch)(f.store),v=(0,c.useCallback)(n=>{n?.preventDefault(),u||(j(),p(!0),d(e,t,{...h,...i},{throwOnError:!0}).then(({id:n})=>{y((0,C.__)("Record saved successfully.","newsletter-optin-box"),{isDismissible:!0,type:"snackbar"}),(0,m.updatePath)(`/${e}/${t}/${n}`)}).catch(e=>{b(e.message,{isDismissible:!0,type:"default"});const t=document.getElementById("hizzlewp-collection__main-content");t&&t.parentElement?.scrollTo({top:0,behavior:"smooth"})}).finally(()=>{p(!1)}))},[h,i,e,t,d,b,y,j]);return(0,g.jsx)(Ce,{record:h,onChange:e=>x({...h,...e}),onSubmit:v,submitText:a?.save_item||"Save",schema:n,hidden:r,ignore:_,loading:u,slotName:`${e}_${t}_record_create_below`,extraSettings:o})},Ee=({children:e})=>(0,g.jsx)(a.FlexItem,{style:{width:400,maxWidth:"100%"},children:(0,g.jsx)(h.ErrorBoundary,{children:e})}),Re=()=>{const{config:{namespace:e,collection:t,labels:n}}=(0,w.useProvidedCollectionConfig)()||{};return(0,g.jsx)(a.CardBody,{children:(0,g.jsxs)(a.__experimentalHStack,{alignment:"flex-start",justify:"space-between",wrap:!0,children:[(0,g.jsx)(a.Fill,{name:`/${e}/${t}/title`,children:(0,g.jsx)(a.__experimentalHeading,{level:1,size:16,truncate:!0,children:n?.add_new_item||"Add New Item"})}),(0,g.jsx)(Ee,{children:(0,g.jsx)(ze,{})}),(0,g.jsx)(a.Slot,{name:`${e}_${t}_record_create_upsell`,children:e=>e?(0,g.jsx)(Ee,{children:e}):null})]})})},Ae=()=>{const{config:{labels:e,tabs:t,namespace:n,collection:r}}=(0,w.useProvidedCollectionConfig)(),s=`${n}/${r}/${(0,w.useProvidedRecordId)()}`,{params:i}=(0,m.useRoute)(),o=[{title:e?.edit_item||e?.singular_name||"Edit",name:"overview"}];t&&!Array.isArray(t)&&Object.entries(t).map(([e,{title:t}])=>o.push({title:t,name:e}));const l=(0,c.useCallback)(e=>{const t=o[e]?.name||"overview",n="overview"===t?s:`${s}/${t}`;(0,m.updatePath)(n)},[s]),d=i?.get("tab")||"overview";return(0,g.jsx)(h.ErrorBoundary,{children:o.length>1?(0,g.jsx)(a.__experimentalHStack,{as:a.NavigableMenu,orientation:"horizontal",className:"hizzle-interface__header-menu",expanded:!1,spacing:0,alignment:"stretch",onNavigate:l,wrap:!0,children:o.map((e,t)=>(0,g.jsx)(a.Button,{isPressed:e.name===d||!d&&0===t,onClick:()=>l(t),__next40pxDefaultSize:!0,children:e.title},e.name))}):(0,g.jsx)(g.Fragment,{children:e?.singular_name||"Item"})})},De=({namespace:e,collection:t,recordId:n})=>{const{record:r}=(0,w.useCollectionRecord)(e,t,n);return(0,g.jsx)(a.Fill,{name:`/${e}/${t}/actions`,children:(0,g.jsx)(me,{actions:r?.hizzlewp_actions,namespace:e,collection:t,id:(0,w.getRawValue)(r?.id),isOverview:!0})})},Fe=({children:e,namespace:t,collection:n,recordId:r})=>{const{record:s,isResolving:i,hasResolved:o,error:l}=(0,w.useCollectionRecord)(t,n,r);return i||!o?(0,g.jsx)(a.Spinner,{}):l||!s?(0,g.jsx)(a.Notice,{status:"error",isDismissible:!1,children:l?.message||"An unknown error occurred."}):(0,g.jsx)(h.ErrorBoundary,{children:e})},Ne=()=>{const e=(0,w.useProvidedRecordId)(),{config:{namespace:t,collection:n}}=(0,w.useProvidedCollectionConfig)();return e?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(a.Fill,{name:`/${t}/${n}/title`,children:(0,g.jsx)(Ae,{})}),(0,g.jsxs)(Fe,{namespace:t,collection:n,recordId:e,children:[(0,g.jsx)(De,{namespace:t,collection:n,recordId:e}),(0,g.jsx)(m.Outlet,{path:"/:namespace/:collection/:recordId"})]})]}):(0,g.jsx)(a.Notice,{status:"error",isDismissible:!1,children:"No record ID found."})},Te=()=>{const e=(0,w.useProvidedRecordId)(),{config:{namespace:t,collection:n,labels:r,props:s,hidden:i,ignore:a,defaultProps:o,settings:d}}=(0,w.useProvidedCollectionConfig)(),{editedRecord:u,edit:p,save:h,isSaving:m}=(0,w.useCollectionRecord)(t,n,e),{createErrorNotice:x,createSuccessNotice:_,removeAllNotices:b}=(0,l.useDispatch)(f.store),y=(0,c.useMemo)(()=>[...a,...Object.keys(o||{})],[a,o]),j=(0,c.useCallback)(e=>{e?.preventDefault(),m||(b(),h().then(()=>{_((0,C.__)("Record saved successfully.","newsletter-optin-box"),{type:"snackbar"})}).catch(e=>{x(e.message,{isDismissible:!0,type:"default"});const t=document.getElementById("hizzlewp-collection__main-content");t&&t.parentElement?.scrollTo({top:0,behavior:"smooth"})}))},[h,m,x,_,b]);return(0,g.jsx)(Ce,{record:u||{},onChange:p,onSubmit:j,submitText:r?.save_item||"Save",schema:s,extraSettings:d,hidden:i,ignore:y,loading:m,slotName:`${t}_${n}_record_overview_below`})},Be=({label:e,actionName:t,namespace:n,collection:r,id:s})=>{const{doRemoteCollectionRecordAction:i}=(0,l.useDispatch)(w.store),{createSuccessNotice:o,createErrorNotice:d}=(0,l.useDispatch)(f.store),u=(0,l.useSelect)(e=>e(w.store).isDoingRemoteCollectionRecordAction(n,r,s,t),[n,r,t,s]),p=(0,c.useCallback)(e=>{e?.preventDefault(),u||i(n,r,s,t).then(e=>{o(e?.message,{type:"snackbar"})}).catch(e=>{d(e.message,{isDismissible:!0,type:"default"});const t=document.getElementById("hizzlewp-collection__main-content");t&&t.parentElement?.scrollTo({top:0,behavior:"smooth"})})},[i,o,d,n,r,t,s]);return(0,g.jsxs)(a.Button,{variant:"secondary",onClick:p,children:[e,u&&(0,g.jsx)(a.Spinner,{})]})},Oe=({value:e,label:t})=>{const{createInfoNotice:n}=(0,l.useDispatch)(f.store),r=(0,ae.useCopyToClipboard)(e,()=>{n("Copied to clipboard.",{type:"snackbar"})});return(0,g.jsx)(a.Button,{label:"Click to copy",variant:"secondary",ref:r,showTooltip:!0,children:t})},Ie=({links:e,...t})=>(0,g.jsx)(a.__experimentalHStack,{justify:"flex-end",spacing:2,wrap:!0,children:e.map(({label:e,value:n,action:r,hide:s})=>s?(0,g.jsx)(d().Fragment,{},e):"delete"===r?(0,g.jsx)(de,{label:e,confirm:n,...t},e):"remote"===r?(0,g.jsx)(Be,{label:e,actionName:n,...t},e):(n&&(n=n.replace(/&amp;/g,"&")),"copy"===r?(0,g.jsx)(Oe,{label:e,value:n,...t},e):(0,g.jsx)(a.Button,{href:n,variant:"secondary",target:"_blank",children:e},e)))}),Pe=({value:e,label:t,status:n="default"})=>(0,g.jsx)("div",{className:`hizzlewp-stat-card hizzlewp-stat-card__${n||"default"}`,children:(0,g.jsxs)(a.Flex,{direction:"column",justify:"center",style:{minHeight:100},children:[(0,g.jsx)(a.FlexItem,{children:(0,g.jsx)(a.__experimentalText,{size:48,weight:600,as:"h2",children:e})}),(0,g.jsx)(a.FlexItem,{children:(0,g.jsx)(a.__experimentalText,{size:13,weight:400,as:"h3",children:t})})]})}),Me=({cards:e})=>(0,g.jsx)(a.__experimentalHStack,{spacing:2,justify:"flex-end",wrap:!0,children:e.map(({title:e,value:t,status:n})=>(0,g.jsx)(a.FlexItem,{children:(0,g.jsx)(Pe,{status:n||"info",label:e,value:(0,g.jsx)("span",{dangerouslySetInnerHTML:{__html:t}})})},e))}),$e=({content:e,buttonText:t,buttonLink:n})=>(0,g.jsx)(a.Card,{variant:"secondary",children:(0,g.jsx)(a.CardBody,{children:(0,g.jsxs)(a.__experimentalVStack,{spacing:8,children:[(0,g.jsx)(i.RawHTML,{children:e}),t&&n&&(0,g.jsx)("div",{children:(0,g.jsx)(a.Button,{variant:"secondary",href:n,text:t})})]})})}),Le=({namespace:e,collection:t,id:n})=>{const r=(0,w.useCollectionRecordTabContent)(e,t,n,"overview");return r.isResolving?(0,g.jsx)(g.Fragment,{children:(0,g.jsxs)(a.__experimentalGrid,{columns:3,children:[(0,g.jsx)("div",{className:"hizzlewp-overview-loading-placeholder__card"}),(0,g.jsx)("div",{className:"hizzlewp-overview-loading-placeholder__card"}),(0,g.jsx)("div",{className:"hizzlewp-overview-loading-placeholder__card"})]})}):!r.error&&Array.isArray(r.data)&&r.data.length?(0,g.jsx)(g.Fragment,{children:r.data.map((r,s)=>{switch(r.type){case"stat_cards":return(0,g.jsx)(Me,{cards:r.cards},s);case"action_links":return(0,g.jsx)(Ie,{links:r.links,namespace:e,collection:t,id:n},s);case"card":return(0,g.jsx)($e,{...r},s);default:return null}})}):null},He=()=>{const e=(0,w.useProvidedRecordId)(),{config:{namespace:t,collection:n}}=(0,w.useProvidedCollectionConfig)();return(0,g.jsx)(a.CardBody,{children:(0,g.jsxs)(a.__experimentalHStack,{alignment:"flex-start",justify:"space-between",wrap:!0,children:[(0,g.jsx)(Ee,{children:(0,g.jsx)(Te,{})}),(0,g.jsx)(Ee,{children:(0,g.jsxs)(a.__experimentalVStack,{spacing:5,children:[(0,g.jsx)(a.Slot,{name:`${t}_${n}_record_overview_upsell`}),(0,g.jsx)(Le,{namespace:t,collection:n,id:e})]})})]})})},Ue=({row:e,header:t,headerKey:n})=>{const{is_list:r,item:s,args:i,is_primary:o,url:l,is_boolean:c,is_badge:d}=t,u=e[n];if(r)return Array.isArray(u)&&0!==u.length?(0,g.jsx)(a.__experimentalVStack,{as:"ul",spacing:4,style:{margin:0},children:u.map((e,t)=>{let n=e;if(s&&i){const t=i.map(t=>e[t]);n=(0,C.sprintf)(s,...t)}return(0,g.jsx)("li",{style:{margin:0},dangerouslySetInnerHTML:{__html:n}},t)})}):"—";if(o&&l){const t=e[l];if(!t)return(0,g.jsx)("div",{className:"hizzle-records__table-title-field",children:u});const n={width:"100%",alignItems:"start",textDecoration:"none"};return(0,g.jsx)("div",{className:"hizzle-records__table-title-field",children:(0,g.jsx)(a.Button,{variant:"link",style:n,href:t,target:"_blank",children:u})})}if(c){const e=u?"yes":"no";return(0,g.jsx)(a.Icon,{icon:e})}if(d&&u)return(0,g.jsx)("span",{className:"hizzlewp-badge",style:E(u),children:u});if("string"==typeof u&&D(u)){const e=u.replace(/data-navigate-collection/g,'href="#" data-navigate-collection');return(0,g.jsx)("div",{dangerouslySetInnerHTML:{__html:e},onClick:e=>{const t=e?.target?.closest?.("a[data-navigate-collection]");if(t){e.preventDefault(),e.stopPropagation();const n=t.getAttribute("data-navigate-collection");(0,m.updateQueryString)({},n,{})}}})}return(0,g.jsx)("div",{dangerouslySetInnerHTML:{__html:u}})},Ve=({namespace:e,collection:t,recordId:n,tabName:r,tab:s})=>{const i=(0,w.useCollectionRecordTabContent)(e,t,n,r),o=(0,c.useMemo)(()=>s.headers.map(e=>({accessorKey:e.name,accessorFn:t=>((e,t)=>{const{is_list:n,item:r,args:s,is_boolean:i,label:a}=t,o=e[t.name];return n?Array.isArray(o)&&0!==o.length?o.map(e=>{let t=e;return r&&s?(0,C.sprintf)(r,...s.map(t=>e[t])):t}).join(" "):"":i?o?a:"":o})(t,e),header:e.label,enableSorting:!1,enableHiding:!e.is_primary,cell:({row:t})=>(0,g.jsx)(Ue,{row:t.original,header:e,headerKey:e.name})})),[s.headers]);return!i.isResolving&&i.error?(0,g.jsx)(a.CardBody,{children:(0,g.jsx)(a.Notice,{status:"error",isDismissible:!1,children:i.error?.message})}):(0,g.jsx)(h.ErrorBoundary,{children:(0,g.jsx)(S.Records,{rowCount:i.data?.length||0,data:i.data||[],columns:o,emptyMessage:s.emptyMessage,isLoading:i.isResolving,searchLabel:"Search",enableRowSelection:!1,enableSorting:!0,enablePagination:!0},`${e}-${t}-${n}-${r}`)})},qe=()=>{const{config:{tabs:e,namespace:t,collection:n}}=(0,w.useProvidedCollectionConfig)(),r=(0,w.useProvidedRecordId)(),{params:s}=(0,m.useRoute)(),i=s?.get("tab")||"overview",o={namespace:t,collection:n,recordId:r,tabName:s?.get("tab")||"overview"},l=(0,c.useMemo)(()=>e&&!Array.isArray(e)&&e[o.tabName]?"table"===e[o.tabName].type?(0,g.jsx)(Ve,{tab:e[o.tabName],...o}):(0,g.jsx)(a.Slot,{name:`${t}-${n}-tab-${o.tabName}`,fillProps:{tab:e[o.tabName],...o}}):(0,g.jsx)(He,{}),[e,o.tabName,t,n,r]);return(0,g.jsx)("div",{id:`tab__${t}-${n}__${i}__content`,className:"hizzlewp-tab__content",children:l})},Qe=({onUpload:e})=>(0,g.jsxs)(a.__experimentalVStack,{spacing:5,style:{maxWidth:500},children:[(0,g.jsx)(a.__experimentalText,{weight:600,as:"h3",children:(0,C.__)("This tool allows you to import existing records from a CSV file.","newsletter-optin-box")}),(0,g.jsxs)(a.FormFileUpload,{accept:"text/csv",onChange:t=>e(t?.currentTarget?.files?.[0]),className:"hizzlewp-block-button is-primary",children:[(0,g.jsx)(a.Icon,{icon:"cloud-upload"}),(0,C.__)("Select a CSV file","newsletter-optin-box")]}),(0,g.jsxs)(a.Tip,{children:[(0,C.__)("The first row of the CSV file should contain the field names/headers.","newsletter-optin-box"),(0,g.jsx)("br",{}),(0,C.__)(" Have a different file type?","newsletter-optin-box")," ",(0,g.jsx)(a.Button,{variant:"link",href:"https://convertio.co/csv-converter/",target:"_blank",text:(0,C.__)("Convert it to CSV","newsletter-optin-box")})]})]}),We=e=>((e=(e=e.replace(/[^a-zA-Z0-9]/g,"")).toLowerCase()).startsWith("cf")&&(e=e.slice(2)),e.startsWith("meta")&&(e=e.slice(4)),e),Ke=({options:e,fieldOptions:t,fieldLabel:n,value:r,setValue:s,customValue:i,setCustomValue:o})=>{const l=(0,h.useOptions)(t);return(0,g.jsxs)(a.__experimentalHStack,{spacing:4,justify:"flex-start",wrap:!0,children:[(0,g.jsx)(a.SelectControl,{label:n,value:r,onChange:s,options:e,__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0,style:{width:"320px",maxWidth:"100%"}}),"-1"===r&&(0,g.jsx)(g.Fragment,{children:l.length>0?(0,g.jsx)(a.SelectControl,{label:(0,C.__)("Select value","newsletter-optin-box"),value:i,onChange:o,options:[{value:"",label:(0,C.__)("Select value","newsletter-optin-box"),disabled:!0},...l],__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0,style:{width:"320px",maxWidth:"100%"}}):(0,g.jsx)(a.TextControl,{label:(0,C.__)("Enter value","newsletter-optin-box"),placeholder:(0,C.__)("Enter a value to assign all imported records","newsletter-optin-box"),value:i,onChange:o,__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0,style:{width:"320px",maxWidth:"100%"}})})]})},Ge=({file:e,back:t,onContinue:n})=>{const{config:{namespace:r,collection:s,ignore:i,props:o}}=(0,w.useProvidedCollectionConfig)()||{},[l,d]=(0,c.useState)([]),[u,p]=(0,c.useState)({}),[h,m]=(0,c.useState)(!1),[f,x]=(0,c.useState)(null);(0,c.useEffect)(()=>{O().parse(e,{header:!0,skipEmptyLines:"greedy",preview:5,complete:e=>{d(e.meta.fields)},error(e){x(e)}})},[e]),(0,c.useEffect)(()=>{if(!l.length)return;const e={};l.forEach(t=>{const n=We(t);let r=!1,s=o.find(e=>{if("date_created"!==e.name&&(e.readonly||[...i,"id"].includes(e.name)))return!1;const t=We(e.name),r=We(e.label);return n===t||n===r});s||(s=o.find(e=>{if("date_created"!==e.name&&(e.readonly||[...i,"id"].includes(e.name)))return!1;const t=We(e.name),r=We(e.label);return n.includes(t)||n.includes(r)||t.includes(n)||r.includes(n)}),r=!0),!s||r&&e[s.name]||(e[s.name]={mapped:!0,value:t,is_boolean:s.is_boolean})}),p(e)},[l,o]);const _=(0,c.useMemo)(()=>{const e=[{value:"",label:(0,C.__)("Ignore Field","newsletter-optin-box")},{value:"-1",label:(0,C.__)("Manually enter value","newsletter-optin-box")},{value:"-2",label:(0,C.__)("Map Field","newsletter-optin-box"),disabled:!0}];return l.forEach(t=>{e.push({value:t,label:t})}),e},[l]);return f?(0,g.jsxs)(a.Notice,{status:"error",isDismissible:!1,children:[(0,g.jsx)("p",{children:f.message}),(0,g.jsx)(a.Button,{variant:"link",onClick:t,children:(0,C.__)("Try again","newsletter-optin-box")})]}):(0,g.jsxs)(a.__experimentalVStack,{spacing:4,children:[(0,g.jsx)(a.Tip,{children:(0,C.__)("Map the headers of your CSV file to record fields.","newsletter-optin-box")}),o.map(e=>{if("date_created"!==e.name&&(e.readonly||[...i,"id"].includes(e.name)))return null;const t=u[e.name]||{is_boolean:e.is_boolean},n=t.value||"";return(0,g.jsx)(Ke,{options:_,fieldLabel:e.label,fieldOptions:e.enum,value:n,setValue:n=>{p({...u,[e.name]:{...t,mapped:!["","-1","-2"].includes(n),value:n}})},customValue:t.customValue||"",setCustomValue:n=>{p({...u,[e.name]:{...t,customValue:n}})}},e.name)}),(0,g.jsx)(a.ToggleControl,{label:(0,C.__)("Update existing records","newsletter-optin-box"),checked:h,onChange:e=>m(e),__nextHasNoMarginBottom:!0}),(0,g.jsx)(a.Slot,{name:`${r}_${s}_import_records_below`,children:e=>(0,g.jsx)(g.Fragment,{children:Array.isArray(e)&&e.map((e,t)=>(0,g.jsx)(a.Tip,{children:e},t))})}),(0,g.jsxs)(a.__experimentalHStack,{justify:"flex-start",wrap:!0,children:[(0,g.jsx)(a.Button,{variant:"primary",onClick:()=>n(u,h),children:(0,C.__)("Import","newsletter-optin-box")}),(0,g.jsx)(a.Button,{variant:"secondary",onClick:t,children:(0,C.__)("Import a different file","newsletter-optin-box")})]})]})},Ze=(e,{type:t,...n})=>{switch(t){case"UPDATE_STATS":return{...e,stats:{...e.stats,...n},previousStats:{...e.stats}};case"UPDATE":return{...e,...n};default:return e}},Je=({file:e,headers:t,back:n,updateRecords:r})=>{const{config:{namespace:s,collection:i,labels:o}}=(0,w.useProvidedCollectionConfig)()||{},[{paused:d,done:u,lastDuration:p,parsed:x,total:_,processed:b,stats:y,previousStats:j,chunks:v},k]=(0,c.useReducer)(Ze,{done:!1,lastDuration:5e3,paused:!1,parsed:!1,total:0,processed:0,stats:{updated:0,created:0,failed:0,skipped:0},previousStats:{updated:0,created:0,failed:0,skipped:0},chunks:[]}),{doBatchCollectionAction:S}=(0,l.useDispatch)(w.store),{createErrorNotice:z,removeAllNotices:E}=(0,l.useDispatch)(f.store),R=(0,c.useCallback)(e=>{E("default","hizzlewp-import-progress"),e.forEach(e=>{z(e.message,{isDismissible:!0,type:"default",context:"hizzlewp-import-progress"})})},[z,E]),A=(e=>(0,c.useCallback)(t=>{const n={};return Object.keys(e).forEach(r=>{""!==e[r].value&&(e[r].mapped?n[r]=t[e[r].value]:void 0!==e[r].customValue&&(n[r]=e[r].customValue),e[r].is_boolean&&(n[r]=!["0","","false","FALSE","no"].includes(n[r])))}),n},[e]))(t);return(0,c.useEffect)(()=>{if(d)return;const e=(new Date).getTime(),t=[...v],n=t.shift();n?(!0===u&&k({type:"UPDATE",done:!1}),S(s,i,{import:n,update:r}).then(e=>{let t={...y},n=[];e?.import?.forEach(e=>{if(e.is_error)return t.failed++,void n.push(e.data);Object.keys(t).forEach(n=>{e.data?.[n]&&t[n]++})}),k({type:"UPDATE_STATS",...t}),R(n)}).catch(e=>{k({type:"UPDATE_STATS",...y,failed:y.failed+n.length}),R([e])}).finally(()=>{const r=Math.min(2e3,(new Date).getTime()-e);if(0===t.length)return void k({type:"UPDATE",processed:b+n.length,chunks:t,lastDuration:Math.ceil(r)});const s=((e,t)=>{if(e<=0||t<=0)return 1;const n=t/e;return Math.min(Math.max(1,Math.floor(2e4*n)),99)})(r,n.length),i=[],a=t.flat();for(let e=0;e<a.length;e+=s){const t=a.slice(e,e+s);i.push(t)}k({type:"UPDATE",processed:b+n.length,chunks:i,lastDuration:Math.ceil(r)})})):!1===u&&k({type:"UPDATE",done:!0})},[v,d,k,S,R]),(0,c.useEffect)(()=>{(e=>{O().parse(e,{header:!0,skipEmptyLines:"greedy",complete(e){(e=>{const t=[];for(let n=0;n<e.data.length;n+=10){const r=e.data.slice(n,n+10);t.push(r.map(e=>A(e)))}k({type:"UPDATE",parsed:!0,total:e.data.length,chunks:t,paused:!1})})(e)},error(e){(e=>{R([e])})(e)}})})(e)},[e,t]),x?0===_?(0,g.jsx)(a.Notice,{isDismissible:!1,status:"error",children:(0,C.sprintf)(
// translators: %s: file name.
// translators: %s: file name.
(0,C.__)("No records found in %s.","newsletter-optin-box"),e.name)}):(0,g.jsxs)(a.__experimentalVStack,{className:"hizzlewp-import-progress",spacing:4,children:[!u&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)(a.__experimentalHeading,{level:3,size:20,children:[(0,C.__)("Importing","newsletter-optin-box"),(0,g.jsx)("code",{children:e.name}),"...  ",!d&&(0,g.jsx)(a.Spinner,{})," ",(0,g.jsx)(a.Button,{variant:"link",onClick:()=>k({type:"UPDATE",paused:!d}),children:d?(0,C.__)("Resume","newsletter-optin-box"):(0,C.__)("Pause","newsletter-optin-box")})]}),!d&&(0,g.jsx)(a.ProgressBar,{value:b?Math.floor(b/_*100):0})]}),u&&(0,g.jsxs)(a.__experimentalHeading,{level:3,size:20,children:[(0,C.__)("Processed","newsletter-optin-box"),(0,g.jsx)("code",{children:e.name})]}),(0,g.jsxs)(a.__experimentalHStack,{spacing:4,justify:"flex-start",wrap:!0,children:[(0,g.jsx)(a.FlexItem,{children:(0,g.jsx)(Pe,{value:(0,g.jsx)(h.AnimatedNumber,{to:_,duration:3e3}),label:(0,C.__)("Records Found","newsletter-optin-box"),status:"light"})}),y.created>0&&(0,g.jsx)(a.FlexItem,{children:(0,g.jsx)(Pe,{value:(0,g.jsx)(h.AnimatedNumber,{from:j.created||0,to:y.created,duration:u||d?300:p}),label:(0,C.__)("Records Created","newsletter-optin-box"),status:"success"})}),y.updated>0&&(0,g.jsx)(a.FlexItem,{children:(0,g.jsx)(Pe,{value:(0,g.jsx)(h.AnimatedNumber,{from:j.updated||0,to:y.updated,duration:u||d?300:p}),label:(0,C.__)("Records Updated","newsletter-optin-box"),status:"success"})}),y.failed>0&&(0,g.jsx)(a.FlexItem,{children:(0,g.jsx)(Pe,{value:(0,g.jsx)(h.AnimatedNumber,{from:j.failed||0,to:y.failed,duration:u||d?300:p}),label:(0,C.__)("Records Failed","newsletter-optin-box"),status:"error"})}),y.skipped>0&&(0,g.jsx)(a.FlexItem,{children:(0,g.jsx)(Pe,{value:(0,g.jsx)(h.AnimatedNumber,{from:j.skipped||0,to:y.skipped,duration:u||d?300:p}),label:(0,C.__)("Records Skipped","newsletter-optin-box"),status:"info"})})]}),u&&(0,g.jsx)("div",{children:(0,g.jsx)(a.Button,{variant:"primary",text:o.view_items||"View Records",onClick:()=>(0,m.updatePath)(`/${s}/${i}`),style:{maxWidth:200}})})]}):(0,g.jsxs)(a.__experimentalHeading,{level:3,size:20,children:[(0,C.__)("Parsing","newsletter-optin-box"),(0,g.jsx)("code",{children:e.name}),"...  ",(0,g.jsx)(a.Spinner,{})]})},Ye=({file:e,back:t})=>{const[n,r]=(0,c.useState)(),[s,i]=(0,c.useState)(!1);return n?(0,g.jsx)(Je,{file:e,headers:n,back:t,updateRecords:s}):(0,g.jsx)(Ge,{file:e,back:t,onContinue:(e,t)=>{r(e),i(t),window.scrollTo({top:0,behavior:"smooth"})}})},Xe=()=>{const{config:{namespace:e,collection:t,labels:n}}=(0,w.useProvidedCollectionConfig)()||{},[r,s]=(0,c.useState)(null);return(0,g.jsxs)(a.CardBody,{children:[(0,g.jsx)(a.Fill,{name:`/${e}/${t}/title`,children:(0,g.jsx)(a.__experimentalHeading,{level:1,size:16,truncate:!0,children:n?.import||"Import"})}),(0,g.jsx)(h.ErrorBoundary,{children:r?(0,g.jsx)(Ye,{file:r,back:()=>s(null)}):(0,g.jsx)(Qe,{onUpload:s})})]})},et=({defaultNamespace:e,defaultCollection:t})=>{const n=(0,c.useMemo)(()=>[{path:"/:namespace/:collection",element:(0,g.jsx)(h.ErrorBoundary,{children:(0,g.jsx)(ve,{defaultNamespace:e,defaultCollection:t})}),index:(0,g.jsx)(h.ErrorBoundary,{children:(0,g.jsx)(be,{})}),children:[{path:"/:namespace/:collection/add",element:(0,g.jsx)(h.ErrorBoundary,{children:(0,g.jsx)(Re,{})})},{path:"/:namespace/:collection/import",element:(0,g.jsx)(h.ErrorBoundary,{children:(0,g.jsx)(Xe,{})})},{path:"/:namespace/:collection/:recordId",element:(0,g.jsx)(h.ErrorBoundary,{children:(0,g.jsx)(Ne,{})}),index:(0,g.jsx)(h.ErrorBoundary,{children:(0,g.jsx)(He,{})}),children:[{path:"/:namespace/:collection/:recordId/:tab",element:(0,g.jsx)(h.ErrorBoundary,{children:(0,g.jsx)(qe,{})})}]}]}],[e,t]);return(0,g.jsx)(h.ErrorBoundary,{children:(0,g.jsx)(m.Router,{basePath:`/${e}/${t}`,routes:n})})},tt=e=>{const t=(0,m.usePath)(),n=(0,c.useMemo)(()=>{if(!e.brand?.menu)return e.brand;const n=e.brand.menu.find(e=>e.updatePath&&t&&t.startsWith(e.updatePath));return{...e.brand,menu:e.brand.menu.map(({updatePath:e,href:t,...r})=>({...r,href:e?void 0:t,onClick:e?()=>{(0,m.getHistory)().push((0,u.addQueryArgs)(t,{hizzlewp_path:e})),(e=>{const t=new URLSearchParams(e.split("?")[1]||"").get("page");t&&setTimeout(()=>{document.querySelectorAll("#adminmenu a").forEach(e=>{const n=e.getAttribute("href");if(n&&n.includes(`page=${t}`)){document.querySelectorAll("#adminmenu .current").forEach(e=>e.classList.remove("current"));const t=e.closest("li");if(t){t.classList.add("current");const e=t.closest(".wp-has-submenu");e&&(e.classList.add("wp-has-current-submenu"),e.classList.add("wp-menu-open"),e.classList.remove("wp-not-current-submenu"))}e.classList.add("current"),e.setAttribute("aria-current","page")}})},0)})(t)}:void 0,isPressed:n?n.updatePath===e:r.isPressed}))}},[e.brand,t]);return(0,g.jsx)(h.ErrorBoundary,{children:(0,g.jsx)(p.Header,{...e,brand:n})})};function nt({defaultNamespace:e,defaultCollection:t,...n}){const r=(0,c.useMemo)(()=>(0,g.jsxs)(a.__experimentalVStack,{id:"hizzlewp-collection__main-content",spacing:4,style:{padding:20},children:[(0,g.jsx)(h.ErrorBoundary,{children:(0,g.jsx)(_,{})}),(0,g.jsx)(h.ErrorBoundary,{children:(0,g.jsx)(x,{})}),(0,g.jsx)(h.ErrorBoundary,{children:(0,g.jsx)(et,{defaultNamespace:e,defaultCollection:t})})]}),[e,t]);return(0,g.jsx)(p.Interface,{className:"hizzlewp-settings__interface",header:(0,g.jsx)(tt,{...n}),content:r})}const{collection:rt,namespace:st,...it}=window.hizzleWPStore?.data||{};s()(()=>{const e=document.getElementById("hizzlewp-store-ui");if(!e||!rt||!st)return;(0,l.dispatch)(o.store).registerShortcut({name:"hizzlewp/save-record",category:"hizzlewp",description:"Save the current record",keyCombination:{modifier:"primary",character:"s"}});const t=()=>(0,g.jsx)(a.SlotFillProvider,{children:(0,g.jsx)(nt,{defaultNamespace:st,defaultCollection:rt,...it})});(0,i.createRoot)(e).render((0,g.jsx)(t,{}))})}},n={};function r(e){var s=n[e];if(void 0!==s)return s.exports;var i=n[e]={exports:{}};return t[e].call(i.exports,i,i.exports,r),i.exports}r.m=t,e=[],r.O=(t,n,s,i)=>{if(!n){var a=1/0;for(d=0;d<e.length;d++){for(var[n,s,i]=e[d],o=!0,l=0;l<n.length;l++)(!1&i||a>=i)&&Object.keys(r.O).every(e=>r.O[e](n[l]))?n.splice(l--,1):(o=!1,i<a&&(a=i));if(o){e.splice(d--,1);var c=s();void 0!==c&&(t=c)}}return t}i=i||0;for(var d=e.length;d>0&&e[d-1][2]>i;d--)e[d]=e[d-1];e[d]=[n,s,i]},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={77:0,385:0};r.O.j=t=>0===e[t];var t=(t,n)=>{var s,i,[a,o,l]=n,c=0;if(a.some(t=>0!==e[t])){for(s in o)r.o(o,s)&&(r.m[s]=o[s]);if(l)var d=l(r)}for(t&&t(n);c<a.length;c++)i=a[c],r.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return r.O(d)},n=globalThis.webpackChunkhizzlewp=globalThis.webpackChunkhizzlewp||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var s=r.O(void 0,[385],()=>r(928));s=r.O(s)})();